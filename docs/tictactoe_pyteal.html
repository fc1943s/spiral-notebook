---

title: imports


keywords: fastai
sidebar: home_sidebar



nb_path: "04_tictactoe_pyteal.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 04_tictactoe_pyteal.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">pip</span> install pyteal | grep -v &#39;already satisfied&#39;
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="ansi-yellow-fg">WARNING: Ignoring invalid distribution -ip (/opt/python/3.10.4/lib/python3.10/site-packages)</span><span class="ansi-yellow-fg">
</span><span class="ansi-yellow-fg">WARNING: Ignoring invalid distribution -ip (/opt/python/3.10.4/lib/python3.10/site-packages)</span><span class="ansi-yellow-fg">
</span><span class="ansi-yellow-fg">WARNING: Ignoring invalid distribution -ip (/opt/python/3.10.4/lib/python3.10/site-packages)</span><span class="ansi-yellow-fg">
</span><span class="ansi-yellow-fg">WARNING: Ignoring invalid distribution -ip (/opt/python/3.10.4/lib/python3.10/site-packages)</span><span class="ansi-yellow-fg">
</span><span class="ansi-yellow-fg">WARNING: Ignoring invalid distribution -ip (/opt/python/3.10.4/lib/python3.10/site-packages)</span><span class="ansi-yellow-fg">
</span><span class="ansi-yellow-fg">WARNING: Ignoring invalid distribution -ip (/opt/python/3.10.4/lib/python3.10/site-packages)</span><span class="ansi-yellow-fg">
</span>Note: you may need to restart the kernel to use updated packages.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">lib_py.util</span> <span class="k">as</span> <span class="nn">util</span>
<span class="kn">import</span> <span class="nn">lib_py.ipython_magic</span> <span class="k">as</span> <span class="nn">ipython_magic</span>

<span class="kn">import</span> <span class="nn">main</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>main.spi Loaded
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">spi</span>

open console_fsx
open pyteal
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;magic:00e50aaaf41b4c2fbd7011f4cb54e887&gt;
</pre>
</div>
</div>

<div class="output_area">




<div id="880b8db6-8e25-4c71-accd-b9989dc625dd" class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#880b8db6-8e25-4c71-accd-b9989dc625dd');
IPython.notebook.save_checkpoint();
</script>
</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;tictactoe_pyteal.spi&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="numGlobal">numGlobal<a class="anchor-link" href="#numGlobal"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">node</span> export

export var numGlobalByteSlices = 5
export var numGlobalInts = 4
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;tictactoe_pyteal.ts&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="AppVariables,-DefaultValues,-AppActions">AppVariables, DefaultValues, AppActions<a class="anchor-link" href="#AppVariables,-DefaultValues,-AppActions"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="AppVariables" class="doc_header"><code>class</code> <code>AppVariables</code><a href="https://github.com/fc1943s/tictactoe_spiral/lib_py/tictactoe_pyteal.py#L14" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>AppVariables</code>()</p>
</blockquote>
<p>All the variables available in the global state of the application.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="DefaultValues" class="doc_header"><code>class</code> <code>DefaultValues</code><a href="https://github.com/fc1943s/tictactoe_spiral/lib_py/tictactoe_pyteal.py#L31" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>DefaultValues</code>()</p>
</blockquote>
<p>The default values for the global variables initialized on the transaction that creates the application.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="AppActions" class="doc_header"><code>class</code> <code>AppActions</code><a href="https://github.com/fc1943s/tictactoe_spiral/lib_py/tictactoe_pyteal.py#L42" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>AppActions</code>()</p>
</blockquote>
<p>Available actions in the tic-tac-toe application.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">spi</span>

let get_bytes () =
    {
        player_x_state = new_bytes &quot;PlayerXState&quot;
        player_o_state = new_bytes &quot;PlayerOState&quot;
        player_x_address = new_bytes &quot;PlayerXAddress&quot;
        player_o_address = new_bytes &quot;PlayerOAddress&quot;
        player_turn_address = new_bytes &quot;PlayerTurnAddress&quot;
        funds_escrow_address = new_bytes &quot;FundsEscrowAddress&quot;
        action_timeout = new_bytes &quot;ActionTimeout&quot;
        game_status = new_bytes &quot;GameState&quot;
        bet_amount = new_bytes &quot;BetAmount&quot;
    }

inl get_default_values () = 
    {
        player_x_state = new_int 0
        player_o_state = new_int 0
        game_status = new_int 0
        bet_amount = new_int 1000000
        game_duration_seconds = new_int 3600
    }

inl get_app_actions () =
    {
        setup_players = new_bytes &quot;SetupPlayers&quot;
        action_move = new_bytes &quot;ActionMove&quot;
        money_refund = new_bytes &quot;MoneyRefund&quot;
    }
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;tictactoe_pyteal.spi&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">b</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">a:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">b:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="clear_program">clear_program<a class="anchor-link" href="#clear_program"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="clear_program" class="doc_header"><code>clear_program</code><a href="https://github.com/fc1943s/tictactoe_spiral/lib_py/tictactoe_pyteal.py#L53" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>clear_program</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">spi</span>

inl clear_program () =
    inspect &quot;clear_program&quot;
    new_return (new_int 1)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;tictactoe_pyteal.spi&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clear_program_python_teal</span> <span class="o">=</span> <span class="n">compileTeal</span><span class="p">(</span><span class="n">clear_program</span><span class="p">(),</span> <span class="n">mode</span><span class="o">=</span><span class="n">Mode</span><span class="o">.</span><span class="n">Application</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>5:clear_program
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clear_program_spiral_teal</span> <span class="o">=</span> <span class="n">compileTeal</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="n">arrow_9</span><span class="p">(),</span> <span class="n">mode</span><span class="o">=</span><span class="n">Mode</span><span class="o">.</span><span class="n">Application</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>clear_program
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test</span><span class="p">(</span><span class="n">clear_program_python_teal</span><span class="p">,</span> <span class="n">clear_program_spiral_teal</span><span class="p">)</span>
<span class="n">util</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="s1">&#39;clear_program.teal&#39;</span><span class="p">,</span> <span class="n">clear_program_spiral_teal</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">clear_program_spiral_teal</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>#pragma version 6
int 1
return
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="money_refund_logic">money_refund_logic<a class="anchor-link" href="#money_refund_logic"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="money_refund_logic" class="doc_header"><code>money_refund_logic</code><a href="https://github.com/fc1943s/tictactoe_spiral/lib_py/tictactoe_pyteal.py#L60" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>money_refund_logic</code>()</p>
</blockquote>
<p>This function handles the logic for refunding the money in case of a winner, tie or timeout termination. If the
player whose turn it is hasn't made a move for the predefined period of time, the other player is declared as a
winner and can withdraw the money.
This action logic should be performed using an Atomic Transfer of 2 transactions in case of a winner or using an
Atomic Transfer of 3 transactions in case of a tie.
If there is a winner the Atomic Transfer should have the following 2 transactions:</p>
<ol>
<li>Application Call with the appropriate application action argument.</li>
<li>Payment from the Escrow to the Winner Address with a amount equal to the 2 * BetAmount.
If there is a tie the Atomic Transfer should have the following 3 transactions:</li>
<li>Application Call with the appropriate application action argument.</li>
<li>Payment from the Escrow to the PlayerX's Address with a amount equal to the BetAmount.</li>
<li>Payment from the Escrow to the PlayerO's Address with a amount equal to the BetAmount.
:return:</li>
</ol>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">spi</span>

inl money_refund_logic () =
    inspect &quot;money_refund_logic&quot;

    inl bytes = get_bytes ()
    
    inl has_x_won_by_playing = app_global_get bytes.game_status = new_int 1
    inl has_x_won_by_timeout = 
        new_and3
            (app_global_get bytes.game_status = new_int 0)
            (global_latest_timestamp () &gt; app_global_get bytes.action_timeout)
            (app_global_get bytes.player_turn_address = app_global_get bytes.player_o_address)
    inl has_x_won = new_or has_x_won_by_playing has_x_won_by_timeout
    inl x_withdraw = 
        new_seq
            ;[
                new_assert (get_gtxn_receiver (get_gtxn 1) = app_global_get bytes.player_x_address)
                new_assert (get_gtxn_amount (get_gtxn 1) = new_int 2 * app_global_get bytes.bet_amount)
                app_global_put bytes.game_status (new_int 1)
            ]

    inl has_o_won_by_playing = app_global_get bytes.game_status = new_int 2
    inl has_o_won_by_timeout = 
        new_and3
            (app_global_get bytes.game_status = new_int 0)
            (global_latest_timestamp () &gt; app_global_get bytes.action_timeout)
            (app_global_get bytes.player_turn_address = app_global_get bytes.player_x_address)
    inl has_o_won = new_or has_o_won_by_playing has_o_won_by_timeout
    inl o_withdraw =
        new_seq
            ;[
                new_assert (get_gtxn_receiver (get_gtxn 1) = app_global_get bytes.player_o_address)
                new_assert (get_gtxn_amount (get_gtxn 1) = new_int 2 * app_global_get bytes.bet_amount)
                app_global_put bytes.game_status (new_int 2)
            ]
            
    inl game_is_tie = app_global_get bytes.game_status = new_int 3
    inl tie_withdraw =
        new_seq
            ;[
                new_assert (get_gtxn_receiver (get_gtxn 1) = app_global_get bytes.player_x_address)
                new_assert (get_gtxn_amount (get_gtxn 1) = app_global_get bytes.bet_amount)
                new_assert (get_gtxn_type_enum (get_gtxn 2) = get_txn_type Payment)
                new_assert (get_gtxn_sender (get_gtxn 2) = app_global_get bytes.funds_escrow_address)
                new_assert (get_gtxn_receiver (get_gtxn 2) = app_global_get bytes.player_o_address)
                new_assert (get_gtxn_amount (get_gtxn 2) = app_global_get bytes.bet_amount)
            ]

    new_seq
        ;[
            new_assert (get_gtxn_type_enum (get_gtxn 1) = get_txn_type Payment)
            new_assert (get_gtxn_sender (get_gtxn 1) = app_global_get bytes.funds_escrow_address)
            new_cond3
                ;[has_x_won; x_withdraw]
                ;[has_o_won; o_withdraw]
                ;[game_is_tie; tie_withdraw]
            new_return (new_int 1)
        ]
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;tictactoe_pyteal.spi&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">money_refund_logic_python_teal</span> <span class="o">=</span> <span class="n">compileTeal</span><span class="p">(</span><span class="n">money_refund_logic</span><span class="p">(),</span> <span class="n">mode</span><span class="o">=</span><span class="n">Mode</span><span class="o">.</span><span class="n">Application</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>5:money_refund_logic
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">money_refund_logic_spiral_teal</span> <span class="o">=</span> <span class="n">compileTeal</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="n">arrow_8</span><span class="p">(),</span> <span class="n">mode</span><span class="o">=</span><span class="n">Mode</span><span class="o">.</span><span class="n">Application</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>money_refund_logic
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test</span><span class="p">(</span><span class="n">money_refund_logic_python_teal</span><span class="p">,</span> <span class="n">money_refund_logic_spiral_teal</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="game_funds_escrow">game_funds_escrow<a class="anchor-link" href="#game_funds_escrow"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="game_funds_escrow" class="doc_header"><code>game_funds_escrow</code><a href="https://github.com/fc1943s/tictactoe_spiral/lib_py/tictactoe_pyteal.py#L127" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>game_funds_escrow</code>(<strong><code>app_id</code></strong>:<code>int</code>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">spi</span>

inl game_funds_escrow app_id =
    inspect &quot;game_funds_escrow&quot;

    inl win_refund = new_seq ;[
        new_assert (get_gtxn_application_id (get_gtxn 0) = new_int app_id)
        new_assert (get_gtxn_fee (get_gtxn 1) &lt;= new_int 1000)
        new_assert (get_gtxn_asset_close_to (get_gtxn 1) = global_zero_address ())
        new_assert (get_gtxn_rekey_to (get_gtxn 1) = global_zero_address ())
    ]

    inl tie_refund = new_seq ;[
        new_assert (get_gtxn_application_id (get_gtxn 0) = new_int app_id)
        new_assert (get_gtxn_fee (get_gtxn 1) &lt;= new_int 1000)
        new_assert (get_gtxn_asset_close_to (get_gtxn 1) = global_zero_address ())
        new_assert (get_gtxn_rekey_to (get_gtxn 1) = global_zero_address ())
        new_assert (get_gtxn_fee (get_gtxn 2) &lt;= new_int 1000)
        new_assert (get_gtxn_asset_close_to (get_gtxn 2) = global_zero_address ())
        new_assert (get_gtxn_rekey_to (get_gtxn 2) = global_zero_address ())
    ]

    new_seq ;[
        new_cond
            ;[global_group_size () = new_int 2; win_refund]
            ;[global_group_size () = new_int 3; tie_refund]
        new_return (new_int 1)
    ]
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;tictactoe_pyteal.spi&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">game_funds_escrow_python_teal</span> <span class="o">=</span> <span class="n">compileTeal</span><span class="p">(</span><span class="n">game_funds_escrow</span><span class="p">(</span><span class="mi">999</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="n">Mode</span><span class="o">.</span><span class="n">Signature</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>3:game_funds_escrow
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">game_funds_escrow_spiral_teal</span> <span class="o">=</span> <span class="n">compileTeal</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="n">arrow_7</span><span class="p">(</span><span class="mi">999</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="n">Mode</span><span class="o">.</span><span class="n">Signature</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>game_funds_escrow
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test</span><span class="p">(</span><span class="n">game_funds_escrow_python_teal</span><span class="p">,</span> <span class="n">game_funds_escrow_spiral_teal</span><span class="p">)</span>
<span class="n">util</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="s1">&#39;game_funds_escrow.teal&#39;</span><span class="p">,</span> <span class="n">game_funds_escrow_spiral_teal</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">game_funds_escrow_spiral_teal</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>#pragma version 6
global GroupSize
int 2
==
bnz main_l4
global GroupSize
int 3
==
bnz main_l3
err
main_l3:
gtxn 0 ApplicationID
int 999
==
assert
gtxn 1 Fee
int 1000
&lt;=
assert
gtxn 1 AssetCloseTo
global ZeroAddress
==
assert
gtxn 1 RekeyTo
global ZeroAddress
==
assert
gtxn 2 Fee
int 1000
&lt;=
assert
gtxn 2 AssetCloseTo
global ZeroAddress
==
assert
gtxn 2 RekeyTo
global ZeroAddress
==
assert
b main_l5
main_l4:
gtxn 0 ApplicationID
int 999
==
assert
gtxn 1 Fee
int 1000
&lt;=
assert
gtxn 1 AssetCloseTo
global ZeroAddress
==
assert
gtxn 1 RekeyTo
global ZeroAddress
==
assert
main_l5:
int 1
return
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="has_player_won">has_player_won<a class="anchor-link" href="#has_player_won"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="has_player_won" class="doc_header"><code>has_player_won</code><a href="https://github.com/fc1943s/tictactoe_spiral/lib_py/tictactoe_pyteal.py#L158" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>has_player_won</code>(<strong><code>state</code></strong>)</p>
</blockquote>
<p>Checks whether the passed state as an argument is a winning state. There are 8 possible winning states in which
a specific pattern of bits needs to be activated.
:param state:
:return:</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">spi</span>

inl _get_winning_moves () =
    ;[
        ;[1; 2; 3]
        ;[4; 5; 6]
        ;[7; 8; 9]
        ;[1; 4; 7]
        ;[2; 5; 8]
        ;[3; 6; 9]
        ;[1; 5; 9]
        ;[3; 5; 7]
    ]

inl get_win_state i : i32 =
    inl i : i32 = i
    match i with
    | 0 =&gt; 448
    | 1 =&gt; 56
    | 2 =&gt; 7
    | 3 =&gt; 292
    | 4 =&gt; 146
    | 5 =&gt; 73
    | 6 =&gt; 273
    | 7 =&gt; 84
    |&gt; new_int

inl has_player_won state =
    inl state : i32 = state
    inspect &quot;has_player_won&quot;

    new_if_else
        (new_or8 
            (new_bitwise_and state (get_win_state 0) = get_win_state 0)
            (new_bitwise_and state (get_win_state 1) = get_win_state 1)
            (new_bitwise_and state (get_win_state 2) = get_win_state 2)
            (new_bitwise_and state (get_win_state 3) = get_win_state 3)
            (new_bitwise_and state (get_win_state 4) = get_win_state 4)
            (new_bitwise_and state (get_win_state 5) = get_win_state 5)
            (new_bitwise_and state (get_win_state 6) = get_win_state 6)
            (new_bitwise_and state (get_win_state 7) = get_win_state 7))
        (new_int 1) 
        (new_int 0)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;tictactoe_pyteal.spi&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">has_player_won_python_teal</span> <span class="o">=</span> <span class="n">compileTeal</span><span class="p">(</span><span class="n">has_player_won</span><span class="p">(</span><span class="n">Int</span><span class="p">(</span><span class="mi">999</span><span class="p">)),</span> <span class="n">mode</span><span class="o">=</span><span class="n">Mode</span><span class="o">.</span><span class="n">Application</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>5:has_player_won
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">has_player_won_spiral_teal</span> <span class="o">=</span> <span class="n">compileTeal</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="n">arrow_6</span><span class="p">(</span><span class="n">Int</span><span class="p">(</span><span class="mi">999</span><span class="p">)),</span> <span class="n">mode</span><span class="o">=</span><span class="n">Mode</span><span class="o">.</span><span class="n">Application</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>has_player_won
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test</span><span class="p">(</span><span class="n">has_player_won_python_teal</span><span class="p">,</span> <span class="n">has_player_won_spiral_teal</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="is_tie">is_tie<a class="anchor-link" href="#is_tie"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="is_tie" class="doc_header"><code>is_tie</code><a href="https://github.com/fc1943s/tictactoe_spiral/lib_py/tictactoe_pyteal.py#L179" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>is_tie</code>()</p>
</blockquote>
<p>Checks whether the game has ended with a tie. Tie state is represented with the number 511 which is the number where
the first 9 bits are active.
:return:</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">spi</span>

inl is_tie () =
    inspect &quot;is_tie&quot;

    inl bytes = get_bytes ()

    inl state_x = app_global_get bytes.player_x_state
    inl state_o = app_global_get bytes.player_o_state
    new_int 511 = new_bitwise_or state_x state_o
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;tictactoe_pyteal.spi&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">is_tie_python_teal</span> <span class="o">=</span> <span class="n">compileTeal</span><span class="p">(</span><span class="n">is_tie</span><span class="p">(),</span> <span class="n">mode</span><span class="o">=</span><span class="n">Mode</span><span class="o">.</span><span class="n">Application</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>5:is_tie
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">is_tie_spiral_teal</span> <span class="o">=</span> <span class="n">compileTeal</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="n">arrow_5</span><span class="p">(),</span> <span class="n">mode</span><span class="o">=</span><span class="n">Mode</span><span class="o">.</span><span class="n">Application</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>is_tie
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test</span><span class="p">(</span><span class="n">is_tie_python_teal</span><span class="p">,</span> <span class="n">is_tie_spiral_teal</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="play_action_logic">play_action_logic<a class="anchor-link" href="#play_action_logic"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="play_action_logic" class="doc_header"><code>play_action_logic</code><a href="https://github.com/fc1943s/tictactoe_spiral/lib_py/tictactoe_pyteal.py#L193" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>play_action_logic</code>()</p>
</blockquote>
<p>Executes an action for the current player in the game and accordingly updates the state of the game. The action
is passed as an argument to the application call.
:return:</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">spi</span>

inl play_action_logic () =
    inspect &quot;play_action_logic&quot;

    inl bytes = get_bytes ()
    inl default_values = get_default_values ()
    inl position_index = new_btoi (get_txn_application_args 1)
    inl state_x = app_global_get bytes.player_x_state
    inl state_o = app_global_get bytes.player_o_state

    inl game_action = new_shift_left (new_int 1) position_index

    inl player_x_move =
        new_seq
            ;[
                app_global_put bytes.player_x_state (new_bitwise_or state_x game_action)
                new_if 
                    (has_player_won (app_global_get bytes.player_x_state))
                    (app_global_put bytes.game_status (new_int 1))
                app_global_put bytes.player_turn_address (app_global_get bytes.player_o_address)
            ]

    inl player_o_move =
        new_seq
            ;[
                app_global_put bytes.player_o_state (new_bitwise_or state_o game_action)
                new_if 
                    (has_player_won (app_global_get bytes.player_o_state))
                    (app_global_put bytes.game_status (new_int 2))
                app_global_put bytes.player_turn_address (app_global_get bytes.player_x_address)
            ]

    new_seq
        ;[
            new_assert (position_index &gt;= new_int 0)
            new_assert (position_index &lt;= new_int 8)
            new_assert (global_latest_timestamp () &lt;= app_global_get bytes.action_timeout)
            new_assert (app_global_get bytes.game_status = default_values.game_status)
            new_assert (get_txn_sender () = app_global_get bytes.player_turn_address)
            new_assert 
                (new_and 
                    (new_bitwise_and state_x game_action = new_int 0)
                    (new_bitwise_and state_o game_action = new_int 0))
            new_cond
                ;[get_txn_sender () = app_global_get bytes.player_x_address; player_x_move]
                ;[get_txn_sender () = app_global_get bytes.player_o_address; player_o_move]
            new_if 
                (is_tie ())
                (app_global_put bytes.game_status (new_int 3))
            new_return (new_int 1)
        ]
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;tictactoe_pyteal.spi&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">play_action_logic_python_teal</span> <span class="o">=</span> <span class="n">compileTeal</span><span class="p">(</span><span class="n">play_action_logic</span><span class="p">(),</span> <span class="n">mode</span><span class="o">=</span><span class="n">Mode</span><span class="o">.</span><span class="n">Application</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>5:play_action_logic
5:has_player_won
5:has_player_won
5:is_tie
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">play_action_logic_spiral_teal</span> <span class="o">=</span> <span class="n">compileTeal</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="n">arrow_4</span><span class="p">(),</span> <span class="n">mode</span><span class="o">=</span><span class="n">Mode</span><span class="o">.</span><span class="n">Application</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>play_action_logic
has_player_won
has_player_won
is_tie
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test</span><span class="p">(</span><span class="n">play_action_logic_python_teal</span><span class="p">,</span> <span class="n">play_action_logic_spiral_teal</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="initialize_players_logic">initialize_players_logic<a class="anchor-link" href="#initialize_players_logic"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="initialize_players_logic" class="doc_header"><code>initialize_players_logic</code><a href="https://github.com/fc1943s/tictactoe_spiral/lib_py/tictactoe_pyteal.py#L238" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>initialize_players_logic</code>()</p>
</blockquote>
<p>This function initializes all the other global variables. The end of the execution of this function defines the game
start. We expect that this logic is performed within an Atomic Transfer of 3 transactions:</p>
<ol>
<li>Application Call with the appropriate application action argument.</li>
<li>Payment transaction from Player X that funds the Escrow account. The address of this sender is represents the
PlayerX address.</li>
<li>Payment transaction from Player O that funds the Escrow account. The address of this sender is represents the
PlayerO address.
:return:</li>
</ol>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">spi</span>

inl initialize_players_logic game_duration_seconds =
    inspect &quot;initialize_players_logic&quot;

    inl bytes = get_bytes ()
    inl default_values = get_default_values ()
    inl player_x_address = app_global_get_ex (new_int 0) bytes.player_x_address
    inl player_o_address = app_global_get_ex (new_int 0) bytes.player_o_address
    inl setup_failed = new_seq ;[new_return (new_int 0)]

    inl game_duration_int =
        match game_duration_seconds with
        | Some duration =&gt; new_int duration
        | None =&gt; default_values.game_duration_seconds
    
    inl setup_players = 
        new_seq 
            ;[
                new_assert (get_gtxn_type_enum (get_gtxn 1) = get_txn_type Payment)
                new_assert (get_gtxn_type_enum (get_gtxn 2) = get_txn_type Payment)
                new_assert (get_gtxn_receiver (get_gtxn 1) = get_gtxn_receiver (get_gtxn 2))
                new_assert (get_gtxn_amount (get_gtxn 1) = app_global_get bytes.bet_amount)
                new_assert (get_gtxn_amount (get_gtxn 2) = app_global_get bytes.bet_amount)
                app_global_put bytes.player_x_address (get_gtxn_sender (get_gtxn 1))
                app_global_put bytes.player_o_address (get_gtxn_sender (get_gtxn 2))
                app_global_put bytes.player_turn_address (get_gtxn_sender (get_gtxn 1))
                app_global_put bytes.funds_escrow_address (get_gtxn_receiver (get_gtxn 1))
                app_global_put bytes.action_timeout (global_latest_timestamp () + game_duration_int)
                new_return (new_int 1)
            ]

    new_seq3
        player_x_address
        player_o_address
        (new_if_else
            (new_or 
                (app_global_has_value player_x_address)
                (app_global_has_value player_o_address))
            setup_failed
            setup_players)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;tictactoe_pyteal.spi&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">initialize_players_logic_python_teal</span> <span class="o">=</span> <span class="n">compileTeal</span><span class="p">(</span><span class="n">initialize_players_logic</span><span class="p">(),</span> <span class="n">mode</span><span class="o">=</span><span class="n">Mode</span><span class="o">.</span><span class="n">Application</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>5:initialize_players_logic
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">initialize_players_logic_spiral_teal</span> <span class="o">=</span> <span class="n">compileTeal</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="n">arrow_3</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="n">US0</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="n">mode</span><span class="o">=</span><span class="n">Mode</span><span class="o">.</span><span class="n">Application</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>initialize_players_logic
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test</span><span class="p">(</span><span class="n">initialize_players_logic_python_teal</span><span class="p">,</span> <span class="n">initialize_players_logic_spiral_teal</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="app_initialization_logic">app_initialization_logic<a class="anchor-link" href="#app_initialization_logic"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="app_initialization_logic" class="doc_header"><code>app_initialization_logic</code><a href="https://github.com/fc1943s/tictactoe_spiral/lib_py/tictactoe_pyteal.py#L281" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>app_initialization_logic</code>()</p>
</blockquote>
<p>Initialization of the default global variables.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">spi</span>

inl app_initialization_logic () =
    inspect &quot;app_initialization_logic&quot;

    inl default_values = get_default_values ()
    inl bytes = get_bytes ()

    new_seq 
        ;[
            app_global_put bytes.player_x_state default_values.player_x_state
            app_global_put bytes.player_o_state default_values.player_o_state
            app_global_put bytes.game_status default_values.game_status
            app_global_put bytes.bet_amount default_values.bet_amount
            new_return (new_int 1)
        ]
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;tictactoe_pyteal.spi&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">app_initialization_logic_python_teal</span> <span class="o">=</span> <span class="n">compileTeal</span><span class="p">(</span><span class="n">app_initialization_logic</span><span class="p">(),</span> <span class="n">mode</span><span class="o">=</span><span class="n">Mode</span><span class="o">.</span><span class="n">Application</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>5:app_initialization_logic
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">app_initialization_logic_spiral_teal</span> <span class="o">=</span> <span class="n">compileTeal</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="n">arrow_2</span><span class="p">(),</span> <span class="n">mode</span><span class="o">=</span><span class="n">Mode</span><span class="o">.</span><span class="n">Application</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>app_initialization_logic
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test</span><span class="p">(</span><span class="n">app_initialization_logic_python_teal</span><span class="p">,</span> <span class="n">app_initialization_logic_spiral_teal</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="application_start">application_start<a class="anchor-link" href="#application_start"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="application_start" class="doc_header"><code>application_start</code><a href="https://github.com/fc1943s/tictactoe_spiral/lib_py/tictactoe_pyteal.py#L297" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>application_start</code>()</p>
</blockquote>
<p>This function represents the start of the application. Here we decide which action will be executed in the current
application call. If we are creating the application for the very first time we are going to initialize some
of the global values with their appropriate default values.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">spi</span>

inl application_start game_duration_seconds =
    inspect &quot;application_start&quot;
    
    inl app_actions = get_app_actions ()

    inl is_app_initialization = get_txn_application_id () = new_int 0
    inl actions =
        new_cond3
            ;[get_txn_application_args 0 = app_actions.setup_players; initialize_players_logic game_duration_seconds]
            ;[new_and 
                (get_txn_application_args 0 = app_actions.action_move) 
                (global_group_size () = new_int 1)
              play_action_logic ()]
            ;[get_txn_application_args 0 = app_actions.money_refund; money_refund_logic ()]

    new_if_else is_app_initialization (app_initialization_logic ()) actions
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;tictactoe_pyteal.spi&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">application_start_python_teal</span> <span class="o">=</span> <span class="n">compileTeal</span><span class="p">(</span><span class="n">application_start</span><span class="p">(),</span> <span class="n">mode</span><span class="o">=</span><span class="n">Mode</span><span class="o">.</span><span class="n">Application</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>5:application_start
5:initialize_players_logic
5:play_action_logic
5:has_player_won
5:has_player_won
5:is_tie
5:money_refund_logic
5:app_initialization_logic
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">application_start_spiral_teal</span> <span class="o">=</span> <span class="n">compileTeal</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="n">arrow_1</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="n">US0</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="n">mode</span><span class="o">=</span><span class="n">Mode</span><span class="o">.</span><span class="n">Application</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>application_start
initialize_players_logic
play_action_logic
has_player_won
has_player_won
is_tie
money_refund_logic
app_initialization_logic
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test</span><span class="p">(</span><span class="n">application_start_python_teal</span><span class="p">,</span> <span class="n">application_start_spiral_teal</span><span class="p">)</span>
<span class="n">util</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="s1">&#39;application_start.teal&#39;</span><span class="p">,</span> <span class="n">application_start_spiral_teal</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">application_start_spiral_teal</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>#pragma version 6
txn ApplicationID
int 0
==
bnz main_l34
txna ApplicationArgs 0
byte &#34;SetupPlayers&#34;
==
bnz main_l31
txna ApplicationArgs 0
byte &#34;ActionMove&#34;
==
global GroupSize
int 1
==
&amp;&amp;
bnz main_l13
txna ApplicationArgs 0
byte &#34;MoneyRefund&#34;
==
bnz main_l5
err
main_l5:
gtxn 1 TypeEnum
int pay
==
assert
gtxn 1 Sender
byte &#34;FundsEscrowAddress&#34;
app_global_get
==
assert
byte &#34;GameState&#34;
app_global_get
int 1
==
byte &#34;GameState&#34;
app_global_get
int 0
==
global LatestTimestamp
byte &#34;ActionTimeout&#34;
app_global_get
&gt;
&amp;&amp;
byte &#34;PlayerTurnAddress&#34;
app_global_get
byte &#34;PlayerOAddress&#34;
app_global_get
==
&amp;&amp;
||
bnz main_l12
byte &#34;GameState&#34;
app_global_get
int 2
==
byte &#34;GameState&#34;
app_global_get
int 0
==
global LatestTimestamp
byte &#34;ActionTimeout&#34;
app_global_get
&gt;
&amp;&amp;
byte &#34;PlayerTurnAddress&#34;
app_global_get
byte &#34;PlayerXAddress&#34;
app_global_get
==
&amp;&amp;
||
bnz main_l11
byte &#34;GameState&#34;
app_global_get
int 3
==
bnz main_l9
err
main_l9:
gtxn 1 Receiver
byte &#34;PlayerXAddress&#34;
app_global_get
==
assert
gtxn 1 Amount
byte &#34;BetAmount&#34;
app_global_get
==
assert
gtxn 2 TypeEnum
int pay
==
assert
gtxn 2 Sender
byte &#34;FundsEscrowAddress&#34;
app_global_get
==
assert
gtxn 2 Receiver
byte &#34;PlayerOAddress&#34;
app_global_get
==
assert
gtxn 2 Amount
byte &#34;BetAmount&#34;
app_global_get
==
assert
main_l10:
int 1
return
main_l11:
gtxn 1 Receiver
byte &#34;PlayerOAddress&#34;
app_global_get
==
assert
gtxn 1 Amount
int 2
byte &#34;BetAmount&#34;
app_global_get
*
==
assert
byte &#34;GameState&#34;
int 2
app_global_put
b main_l10
main_l12:
gtxn 1 Receiver
byte &#34;PlayerXAddress&#34;
app_global_get
==
assert
gtxn 1 Amount
int 2
byte &#34;BetAmount&#34;
app_global_get
*
==
assert
byte &#34;GameState&#34;
int 1
app_global_put
b main_l10
main_l13:
txna ApplicationArgs 1
btoi
int 0
&gt;=
assert
txna ApplicationArgs 1
btoi
int 8
&lt;=
assert
global LatestTimestamp
byte &#34;ActionTimeout&#34;
app_global_get
&lt;=
assert
byte &#34;GameState&#34;
app_global_get
int 0
==
assert
txn Sender
byte &#34;PlayerTurnAddress&#34;
app_global_get
==
assert
byte &#34;PlayerXState&#34;
app_global_get
int 1
txna ApplicationArgs 1
btoi
shl
&amp;
int 0
==
byte &#34;PlayerOState&#34;
app_global_get
int 1
txna ApplicationArgs 1
btoi
shl
&amp;
int 0
==
&amp;&amp;
assert
txn Sender
byte &#34;PlayerXAddress&#34;
app_global_get
==
bnz main_l25
txn Sender
byte &#34;PlayerOAddress&#34;
app_global_get
==
bnz main_l16
err
main_l16:
byte &#34;PlayerOState&#34;
byte &#34;PlayerOState&#34;
app_global_get
int 1
txna ApplicationArgs 1
btoi
shl
|
app_global_put
byte &#34;PlayerOState&#34;
app_global_get
int 448
&amp;
int 448
==
byte &#34;PlayerOState&#34;
app_global_get
int 56
&amp;
int 56
==
||
byte &#34;PlayerOState&#34;
app_global_get
int 7
&amp;
int 7
==
||
byte &#34;PlayerOState&#34;
app_global_get
int 292
&amp;
int 292
==
||
byte &#34;PlayerOState&#34;
app_global_get
int 146
&amp;
int 146
==
||
byte &#34;PlayerOState&#34;
app_global_get
int 73
&amp;
int 73
==
||
byte &#34;PlayerOState&#34;
app_global_get
int 273
&amp;
int 273
==
||
byte &#34;PlayerOState&#34;
app_global_get
int 84
&amp;
int 84
==
||
bnz main_l24
int 0
main_l18:
bnz main_l23
main_l19:
byte &#34;PlayerTurnAddress&#34;
byte &#34;PlayerXAddress&#34;
app_global_get
app_global_put
main_l20:
int 511
byte &#34;PlayerXState&#34;
app_global_get
byte &#34;PlayerOState&#34;
app_global_get
|
==
bnz main_l22
main_l21:
int 1
return
main_l22:
byte &#34;GameState&#34;
int 3
app_global_put
b main_l21
main_l23:
byte &#34;GameState&#34;
int 2
app_global_put
b main_l19
main_l24:
int 1
b main_l18
main_l25:
byte &#34;PlayerXState&#34;
byte &#34;PlayerXState&#34;
app_global_get
int 1
txna ApplicationArgs 1
btoi
shl
|
app_global_put
byte &#34;PlayerXState&#34;
app_global_get
int 448
&amp;
int 448
==
byte &#34;PlayerXState&#34;
app_global_get
int 56
&amp;
int 56
==
||
byte &#34;PlayerXState&#34;
app_global_get
int 7
&amp;
int 7
==
||
byte &#34;PlayerXState&#34;
app_global_get
int 292
&amp;
int 292
==
||
byte &#34;PlayerXState&#34;
app_global_get
int 146
&amp;
int 146
==
||
byte &#34;PlayerXState&#34;
app_global_get
int 73
&amp;
int 73
==
||
byte &#34;PlayerXState&#34;
app_global_get
int 273
&amp;
int 273
==
||
byte &#34;PlayerXState&#34;
app_global_get
int 84
&amp;
int 84
==
||
bnz main_l30
int 0
main_l27:
bnz main_l29
main_l28:
byte &#34;PlayerTurnAddress&#34;
byte &#34;PlayerOAddress&#34;
app_global_get
app_global_put
b main_l20
main_l29:
byte &#34;GameState&#34;
int 1
app_global_put
b main_l28
main_l30:
int 1
b main_l27
main_l31:
int 0
byte &#34;PlayerXAddress&#34;
app_global_get_ex
store 1
store 0
int 0
byte &#34;PlayerOAddress&#34;
app_global_get_ex
store 3
store 2
load 1
load 3
||
bnz main_l33
gtxn 1 TypeEnum
int pay
==
assert
gtxn 2 TypeEnum
int pay
==
assert
gtxn 1 Receiver
gtxn 2 Receiver
==
assert
gtxn 1 Amount
byte &#34;BetAmount&#34;
app_global_get
==
assert
gtxn 2 Amount
byte &#34;BetAmount&#34;
app_global_get
==
assert
byte &#34;PlayerXAddress&#34;
gtxn 1 Sender
app_global_put
byte &#34;PlayerOAddress&#34;
gtxn 2 Sender
app_global_put
byte &#34;PlayerTurnAddress&#34;
gtxn 1 Sender
app_global_put
byte &#34;FundsEscrowAddress&#34;
gtxn 1 Receiver
app_global_put
byte &#34;ActionTimeout&#34;
global LatestTimestamp
int 3600
+
app_global_put
int 1
return
main_l33:
int 0
return
main_l34:
byte &#34;PlayerXState&#34;
int 0
app_global_put
byte &#34;PlayerOState&#34;
int 0
app_global_put
byte &#34;GameState&#34;
int 0
app_global_put
byte &#34;BetAmount&#34;
int 1000000
app_global_put
int 1
return
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="main">main<a class="anchor-link" href="#main"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">spiral</span>

open util
open console_fsx
open tictactoe_pyteal

inl imports () =
    $&quot;#r \&quot;nuget: Fable.Python\&quot;&quot;
    $&quot;open Fable.Core.PyInterop&quot;
    $&quot;open Fable.Core&quot;

inl tests () =
    inl a = 1i32
    inl b = 1i32
    test (a = b)

inl main () =
    inspect &quot;main.spi Loaded&quot;

    imports ()
    tests ()

    (
        application_start,
        app_initialization_logic,
        initialize_players_logic,
        play_action_logic,
        is_tie,
        has_player_won,
        game_funds_escrow,
        money_refund_logic,
        clear_program
    )
    |&gt; dyn
    |&gt; ignore
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;main.spi&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">node</span> run

import * as spiral_api from &quot;./spiral_api&quot;

await spiral_api.spiToFsx()
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">spiral</span> run

inspect &quot;test2&quot;
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>build output: []
fsx: 
let v0 : string = &#34;test2&#34;
printfn $&#34;%A{v0}&#34;

</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;main.spi&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>


