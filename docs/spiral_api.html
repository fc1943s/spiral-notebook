---

title: python


keywords: fastai
sidebar: home_sidebar



nb_path: "01_spiral_api.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 01_spiral_api.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">lib_py.ipython_magic</span> <span class="k">as</span> <span class="nn">ipython_magic</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="node">node<a class="anchor-link" href="#node"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">node</span> export

import * as zmq from &quot;zeromq&quot;

var requestRun = async (prev: Promise&lt;string | null&gt;, file: any): Promise&lt;string | null&gt; =&gt; {
    const port = 13805
    await prev // Waiting on the previous request is so they get ordered properly. Otherwise, messages might fill up and fire in arbitrary order.
    const sock = new zmq.Request()
    const uriServer = `tcp://localhost:${port}`
    sock.connect(uriServer)
    await sock.send(JSON.stringify(file))
    const [x] = await sock.receive()
    sock.disconnect(uriServer)
    return x ? x.toString() : null
}
var prev_request: Promise&lt;string | null&gt; = new Promise(resolve =&gt; resolve(null))
var request = async (file: any) =&gt; { prev_request = requestRun(prev_request, file); return prev_request }
var requestJSON = (file: any) =&gt; request(file).then(x =&gt; x ? JSON.parse(x) : undefined)

var spiBuildFileReq = async (uri: string, backend: string): Promise&lt;void&gt; =&gt; requestJSON({ BuildFile: { uri, backend } })
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;magic:15f0bc8d4afd48d88dc9a77cd86a00a5&gt;
</pre>
</div>
</div>

<div class="output_area">




<div id="84b201d4-e3a2-410c-8177-5d7a091940f0" class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#84b201d4-e3a2-410c-8177-5d7a091940f0');
IPython.notebook.save_checkpoint();
</script>
</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;spiral_api.ts&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">node</span> export

import * as fs from &quot;fs&quot;
import * as path from &quot;path&quot;
import * as util from &quot;./util&quot;

export var spiToFsx = async (spiPath = &#39;&#39;, log = false) =&gt; {
    spiPath = spiPath || path.join(process.cwd(), &#39;main.spi&#39;)
    const fsxPath = spiPath.replace(&#39;.spi&#39;, &#39;.fsx&#39;)
    await util.timeout(spiBuildFileReq(spiPath, &#39;Fsharp&#39;), 2000)
    await util.waitFileChange(fsxPath)
    const lines = fs.readFileSync(fsxPath).toString().split(&#39;\n&#39;)
    const [imports, code] = lines.reduce(
        ([imports, code]: string[][], line) =&gt;
            /^(open|\#r) .*?$/.test(line)
                ? [[...imports, line], code]
                : [imports, [...code, line]],
            [[], []]
    )
    fs.writeFileSync(fsxPath, [...imports, &#39;&#39;, ...code].join(&#39;\n&#39;))
    if(log) {
        util.logStep(&#39;spiral.spiToFsx() end&#39;)
    }
}
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;spiral_api.ts&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">node</span> run

await spiToFsx()
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>


