var Z=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function L(R){var $=R.default;if(typeof $=="function"){var A=function(){return $.apply(this,arguments)};A.prototype=$.prototype}else A={};return Object.defineProperty(A,"__esModule",{value:!0}),Object.keys(R).forEach(function(M){var a=Object.getOwnPropertyDescriptor(R,M);Object.defineProperty(A,M,a.get?a:{enumerable:!0,get:function(){return R[M]}})}),A}function Y(R){throw new Error('Could not dynamically require "'+R+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var X={exports:{}};(function(R){(function(){function $(M,a){return a?Y(M):M.slice?$[m(M)]:function(d,k){M(d={exports:{}}),$[m(k)]=d.exports};function m(d){return d.split("/").slice(-1).toString().replace(".js","")}}var A=R;$(function(M){String.random=function(m,d){var k="";for(m=m||24,d=d||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";m-- >0;)k+=d.charAt(Math.floor(Math.random()*d.length));return k},String.match=function(m,d){var k,b;return typeof m!="string"?!1:(typeof d=="string"&&(d={"=":d}),d=d||{},k=d["="]||d["*"]||d[">"]||d["<"],m===k?!0:b!==d["="]?!1:(k=d["*"]||d[">"],m.slice(0,(k||"").length)===k?!0:b!==d["*"]?!1:b!==d[">"]&&b!==d["<"]?m>=d[">"]&&m<=d["<"]:b!==d[">"]&&m>=d[">"]||b!==d["<"]&&m<=d["<"]))},String.hash=function(m,d){if(typeof m=="string"){if(d=d||0,!m.length)return d;for(var k=0,b=m.length,s;k<b;++k)s=m.charCodeAt(k),d=(d<<5)-d+s,d|=0;return d}};var a=Object.prototype.hasOwnProperty;Object.plain=function(m){return m?m instanceof Object&&m.constructor===Object||Object.prototype.toString.call(m).match(/^\[object (\w+)\]$/)[1]==="Object":!1},Object.empty=function(m,d){for(var k in m)if(a.call(m,k)&&(!d||d.indexOf(k)==-1))return!1;return!0},Object.keys=Object.keys||function(m){var d=[];for(var k in m)a.call(m,k)&&d.push(k);return d},function(){var m,d=setTimeout,k=0,b=0,s=typeof setImmediate!=""+m&&setImmediate||function(u,j){return typeof MessageChannel==""+m?d:((u=new MessageChannel).port1.onmessage=function(O){O.data==""&&j()},function(O){j=O,u.port2.postMessage("")})}(),f=d.check=d.check||typeof performance!=""+m&&performance||{now:function(){return+new Date}};d.hold=d.hold||9,d.poll=d.poll||function(u){if(d.hold>=f.now()-k&&b++<3333){u();return}s(function(){k=f.now(),u()},b=0)}}(),function(){var m=setTimeout,d=m.turn=m.turn||function(j){k.push(j)==1&&b(u)},k=d.s=[],b=m.poll,s=0,f,u=function(){(f=k[s++])&&f(),(s==k.length||s==99)&&(k=d.s=k.slice(s),s=0),k.length&&b(u)}}(),function(){var m,d=setTimeout,k=d.turn;(d.each=d.each||function(b,s,f,u){u=u||9,function j(O,o,_){if(o=(O=(b||[]).splice(0,u)).length){for(var h=0;h<o&&m===(_=s(O[h]));h++);if(m===_){k(j);return}}f&&f(_)}()})()}()})($,"./shim"),$(function(M){M.exports=function a(f,d,k){if(!f)return{to:a};var b,s=typeof d=="function",f=(this.tag||(this.tag={}))[f]||s&&(this.tag[f]={tag:f,to:a._={next:function(j){var O;(O=this.to)&&O.next(j)}}});if(s){var u={off:a.off||(a.off=function(){if(this.next===a._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=a._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:a._,next:d,the:f,on:this,as:k};return(u.back=f.last||f).to=u,f.last=u}return(f=f.to)&&b!==d&&f.next(d),f}})($,"./onto"),$(function(M){M.exports=function(a){return a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"&&a!=1/0&&a!=-1/0&&a===a||!!a&&typeof a["#"]=="string"&&Object.keys(a).length===1&&a["#"]}})($,"./valid"),$(function(M){$("./shim");function a(){var f=+new Date;return b<f?(d=0,b=f+a.drift):b=f+(d+=1)/k+a.drift}a.drift=0;var m=-1/0,d=0,k=999,b=m,s;a.is=function(f,u,j){var O=u&&f&&f._&&f._[">"]||j;if(!!O)return typeof(O=O[u])=="number"?O:m},a.ify=function(f,u,j,O,o){(f=f||{})._=f._||{},o&&(f._["#"]=o);var _=f._[">"]||(f._[">"]={});return s!==u&&u!=="_"&&(typeof j=="number"&&(_[u]=j),s!==O&&(f[u]=O)),f},M.exports=a})($,"./state"),$(function(M){$("./shim");function a(m){var d={s:{}},k=d.s;m=m||{max:999,age:1e3*9},d.check=function(s){return k[s]?b(s):!1};var b=d.track=function(s){var f=k[s]||(k[s]={});return f.was=d.now=+new Date,d.to||(d.to=setTimeout(d.drop,m.age+9)),f};return d.drop=function(s){d.to=null,d.now=+new Date;var f=Object.keys(k);console.STAT&&console.STAT(d.now,+new Date-d.now,"dup drop keys"),setTimeout.each(f,function(u){var j=k[u];j&&(s||m.age)>d.now-j.was||delete k[u]},0,99)},d}M.exports=a})($,"./dup"),$(function(M){$("./onto"),M.exports=function(d,k){if(!!this.on){var b=(this.opt||{}).lack||9e3;if(typeof d!="function"){if(!d)return;var f=d["#"]||d,s=(this.tag||"")[f];return s?(k&&(s=this.on(f,k),clearTimeout(s.err),s.err=setTimeout(function(){s.off()},b)),!0):void 0}var f=k&&k["#"]||a(9);if(!d)return f;var u=this.on(f,d,k);return u.err=u.err||setTimeout(function(){u.off(),u.next({err:"Error: No ACK yet.",lack:!0})},b),f}};var a=String.random||function(){return Math.random().toString(36).slice(2)}})($,"./ask"),$(function(M){function a(o){return o instanceof a?(this._={$:this}).$:this instanceof a?a.create(this._={$:this,opt:o}):new a(o)}a.is=function(o){return o instanceof a||o&&o._&&o===o._.$||!1},a.version=.202,a.chain=a.prototype,a.chain.toJSON=function(){},$("./shim"),a.valid=$("./valid"),a.state=$("./state"),a.on=$("./onto"),a.dup=$("./dup"),a.ask=$("./ask"),function(){a.create=function(n){n.root=n.root||n,n.graph=n.graph||{},n.on=n.on||a.on,n.ask=n.ask||a.ask,n.dup=n.dup||a.dup();var r=n.$.opt(n.opt);return n.once||(n.on("in",o,n),n.on("out",o,n),n.on("put",S,n),a.on("create",n),n.on("create",n)),n.once=1,r};function o(n){if(!!n){if(n.out===o){this.to.next(n);return}var r=this,l=r.as,D=l.at||l,g=D.$,w=D.dup,N,I=n.DBG;if((N=n["#"])||(N=n["#"]=d(9)),!w.check(N)){if(w.track(N),N=n._,n._=typeof N=="function"?N:function(){},n.$&&n.$===(n.$._||"").$||(n.$=g),n["@"]&&!n.put&&t(n),!D.ask(n["@"],n))if(I&&(I.u=+new Date),n.put){_(n);return}else n.get&&a.on.get(n,g);I&&(I.uc=+new Date),r.to.next(n),I&&(I.ua=+new Date),!(n.nts||n.NTS)&&(n.out=o,D.on("out",n),I&&(I.ue=+new Date))}}}function _(n){if(!!n){var r=n._||"",l=r.root=((r.$=n.$||"")._||"").root;if(n["@"]&&r.faith&&!r.miss){n.out=o,l.on("out",n);return}r.latch=l.hatch,r.match=l.hatch=[];var D=n.put,g=r.DBG=n.DBG,w=+new Date;if(G=G||w,!(D["#"]&&D["."])){g&&(g.p=w),r["#"]=n["#"],r.msg=n,r.all=0,r.stun=1;var N=Object.keys(D);console.STAT&&console.STAT(w,((g||r).pk=+new Date)-w,"put sort");var I=0,J,E,P,C,q,W,F;(function U(K){if(J!=I){if(J=I,!(P=N[I])){console.STAT&&console.STAT(w,((g||r).pd=+new Date)-w,"put"),y(r);return}(C=D[P])?(F=C._)?P!==F["#"]?W=p+T(P)+"soul not same.":(q=F[">"])||(W=p+T(P)+"no state."):W=p+T(P)+"no meta.":W=p+T(P)+"no node.",E=Object.keys(C||{})}if(W){n.err=r.err=W,y(r);return}var V=0,H;for(K=K||0;K++<9&&(H=E[V++]);)if(H!=="_"){var z=C[H],Q=q[H];if(u===Q){W=p+T(H)+"on"+T(P)+"no state.";break}if(!b(z)){W=p+T(H)+"on"+T(P)+"bad "+typeof z+T(z);break}h(z,H,P,Q,n),++B}if((E=E.slice(V)).length){k(U);return}++I,E=null,U(K)})()}}}a.on.put=_;function h(n,r,l,D,g){var w=g._||"",N=w.root,I=N.graph,J,E=I[l]||j,P=s(E,r,1),C=E[r],q=w.DBG;(J=console.STAT)&&(!I[l]||!C)&&(J.has=(J.has||0)+1);var W=x();if(D>W){setTimeout(function(){h(n,r,l,D,g)},(J=D-W)>v?v:J),console.STAT&&console.STAT((q||w).Hf=+new Date,J,"future");return}if(!(D<P)&&!(!w.faith&&D===P&&(n===C||c(n)<=c(C))&&!w.miss)){w.stun++;var F=g["#"]+w.all++,U={toString:function(){return F},_:w};U.toJSON=U.toString,N.dup.track(U)["#"]=g["#"],q&&(q.ph=q.ph||+new Date),N.on("put",{"#":U,"@":g["@"],put:{"#":l,".":r,":":n,">":D},ok:g.ok,_:w})}}function S(n){var r;(r=(n._||"").DBG)&&(r.pa=+new Date,r.pm=r.pm||+new Date);var l=this,D=l.as,g=D.graph,w=n._,N=n.put,I=N["#"],J=N["."],E=N[":"],P=N[">"];n["#"];var C;(C=w.msg)&&(C=C.put)&&(C=C[I])&&f(C,J,P,E,I),g[I]=f(g[I],J,P,E,I),(C=(D.next||"")[I])&&C.on("in",n),y(w),l.to.next(n)}function y(n,r){var l;if(!n.stop&&!(!n.err&&0<--n.stun)&&(n.stop=1,!!(l=n.root))){var D=n.match;D.end=1,D===l.hatch&&(!(D=n.latch)||D.end?delete l.hatch:l.hatch=D),n.hatch&&n.hatch(),setTimeout.each(n.match,function(g){g&&g()}),!(!(r=n.msg)||n.err||r.err)&&(r.out=o,n.root.on("out",r),e())}}function t(n){var r=n["@"]||"",l;if(!(l=r._)){var D=(D=n.$)&&(D=D._)&&(D=D.root)&&(D=D.dup);if(!(D=D.check(r)))return;n["@"]=D["#"]||n["@"];return}l.acks=(l.acks||0)+1,(l.err=n.err)&&(n["@"]=l["#"],y(l)),l.ok=n.ok||l.ok,!l.stop&&!l.crack&&(l.crack=l.match&&l.match.push(function(){i(l)})),i(l)}function i(n){!n||!n.root||n.stun||n.acks!==n.all||n.root.on("in",{"@":n["#"],err:n.err,ok:n.err?u:n.ok||{"":1}})}var p="Error: Invalid graph!",T=function(n){return" '"+(""+n).slice(0,9)+"...' "},c=JSON.stringify,v=2147483647,x=a.state,B=0,G,e=function(){B>999&&B/-(G-(G=+new Date))>1&&(a.window&&console.log("Warning: You're syncing 1K+ records a second, faster than DOM can update - consider limiting query."),e=function(){B=0})}}(),function(){a.on.get=function(_,h){var S=h._,y=_.get,t=y["#"],i=S.graph[t],p=y["."],T=S.next||(S.next={});T[t];var c=_._||{},v=c.DBG=_.DBG;if(v&&(v.g=+new Date),!i)return S.on("get",_);if(p){if(typeof p!="string"||u===i[p])return S.on("get",_);i=f({},p,s(i,p),i[p],t)}i&&o(_,i),S.on("get",_)};function o(_,h){var S=+new Date,y=_._||{},t=y.DBG=_.DBG,i=_["#"],p=d(9),T=Object.keys(h||"").sort(),c=((h||"")._||"")["#"];T.length;var v=_.$._.root,x=h===v.graph[c];console.STAT&&console.STAT(S,((t||y).gk=+new Date)-S,"got keys"),h&&function B(){S=+new Date;for(var G=0,e,n={},r;G<9&&(e=T[G++]);)f(n,e,s(h,e),h[e],c);T=T.slice(G),(r={})[c]=n,n=r;var l;x&&(l=function(){},l.ram=l.faith=!0),r=T.length,console.STAT&&console.STAT(S,-(S-(S=+new Date)),"got copied some"),t&&(t.ga=+new Date),v.on("in",{"@":i,"#":p,put:n,"%":r?p=d(9):u,$:v.$,_:l,DBG:t}),console.STAT&&console.STAT(S,+new Date-S,"got in"),r&&setTimeout.turn(B)}(),h||v.on("in",{"@":_["#"]})}a.on.get.ack=o}(),function(){a.chain.opt=function(o){o=o||{};var _=this,h=_._,S=o.peers||o;return Object.plain(o)||(o={}),Object.plain(h.opt)||(h.opt=o),typeof S=="string"&&(S=[S]),Object.plain(h.opt.peers)||(h.opt.peers={}),S instanceof Array&&(o.peers={},S.forEach(function(y){var t={};t.id=t.url=y,o.peers[y]=h.opt.peers[y]=h.opt.peers[y]||t})),m(o,function y(t){var i=this[t];if(this&&this.hasOwnProperty(t)||typeof i=="string"||Object.empty(i)){this[t]=i;return}i&&i.constructor!==Object&&!(i instanceof Array)||m(i,y)}),h.opt.from=o,a.on("opt",h),h.opt.uuid=h.opt.uuid||function(t){return a.state().toString(36).replace(".","")+String.random(t||12)},_}}();var m=function(o,_){Object.keys(o).forEach(_,o)},d=String.random,k=setTimeout.turn,b=a.valid,s=a.state.is,f=a.state.ify,u,j={},O;a.log=function(){return!a.log.off&&O.log.apply(O,arguments),[].slice.call(arguments).join(" ")},a.log.once=function(o,_,h){return(h=a.log.once)[o]=h[o]||0,h[o]++||a.log(_)},typeof window<"u"&&((window.GUN=window.Gun=a).window=window);try{typeof A<"u"&&(A.exports=a)}catch{}M.exports=a,(a.window||{}).console=(a.window||{}).console||{log:function(){}},(O=console).only=function(o,_){return O.only.i&&o===O.only.i&&O.only.i++&&(O.log.apply(O,arguments)||_)},a.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")})($,"./root"),$(function(M){var a=$("./root");a.chain.back=function(k,b){var s;if(k=k||1,k===-1||k===1/0)return this._.root.$;if(k===1)return(this._.back||this._).$;var f=this,u=f._;if(typeof k=="string"&&(k=k.split(".")),k instanceof Array){var j=0,O=k.length,s=u;for(j;j<O;j++)s=(s||m)[k[j]];return d!==s?b?f:s:(s=u.back)?s.$.back(k,b):void 0}if(typeof k=="function"){for(var o,s={back:u};(s=s.back)&&d===(o=k(s,b)););return o}return typeof k=="number"?(u.back||u).$.back(k-1):this};var m={},d})($,"./back"),$(function(M){var a=$("./root");a.chain.chain=function(y){var t=this,i=t._,p=new(y||t).constructor(t),T=p._,c;return T.root=c=i.root,T.id=++c.once,T.back=t._,T.on=a.on,T.on("in",a.on.in,T),T.on("out",a.on.out,T),p};function m(y){var t,i=this.as,p=i.back,T=i.root,c;if(y.$||(y.$=i.$),this.to.next(y),i.err){i.on("in",{put:i.put=u,$:i.$});return}if(t=y.get){if(T.pass&&(T.pass[i.id]=i),i.lex&&Object.keys(i.lex).forEach(function(v){c[v]=i.lex[v]},c=y.get=y.get||{}),t["#"]||i.soul){if(t["#"]=t["#"]||i.soul,y["#"]||(y["#"]=j(9)),p=T.$.get(t["#"])._,t=t["."]){if(o(p.put,t)&&(c=p.ask&&p.ask[t],(p.ask||(p.ask={}))[t]=p.$.get(t)._,p.on("in",{get:t,put:{"#":p.soul,".":t,":":p.put[t],">":h(T.graph[p.soul],t)}}),c))return}else{if(c=p.ask&&p.ask[""],(p.ask||(p.ask={}))[""]=p,u!==p.put&&(p.on("in",p),c))return;y.$=p.$}return T.ask(s,y),T.on("in",y)}if(t["."])return i.get?(y={get:{".":i.get},$:i.$},(p.ask||(p.ask={}))[i.get]=y.$._,p.on("out",y)):(y={get:i.lex?y.get:{},$:i.$},p.on("out",y));if((i.ask||(i.ask={}))[""]=i,i.get)return t["."]=i.get,(p.ask||(p.ask={}))[i.get]=y.$._,p.on("out",y)}return p.on("out",y)}a.on.out=m;function d(y,t){t=t||this.as;var i=t.root,p=y.$||(y.$=t.$),T=(p||"")._||f,c=y.put||"",v=c["#"],x=c["."],B=u!==c["="]?c["="]:c[":"],G=c[">"]||-1/0,e;if(u!==y.put&&(u===c["#"]||u===c["."]||u===c[":"]&&u===c["="]||u===c[">"])){if(!O(c)){if(!(v=((c||"")._||"")["#"])){console.log("chain not yet supported for",c,"...",y,t);return}return p=t.root.$.get(v),setTimeout.each(Object.keys(c).sort(),function(n){n=="_"||u===(G=h(c,n))||t.on("in",{$:p,put:{"#":v,".":n,"=":c[n],">":G},VIA:y})})}t.on("in",{$:T.back.$,put:{"#":v=T.back.soul,".":x=T.has||T.get,"=":c,">":h(T.back.put,x)},via:y});return}(y.seen||"")[t.id]||((y.seen||(y.seen=function(){}))[t.id]=t,t!==T&&(Object.keys(y).forEach(function(n){c[n]=y[n]},c={}),c.get=t.get||c.get,!t.soul&&!t.has?c.$$$=c.$$$||t.$:T.soul&&(c.$=t.$,c.$$=c.$$||T.$),y=c),b(y,t),(t.soul||y.$$)&&G>=h(i.graph[v],x)&&((c=i.$.get(v)._).put=S(c.put,x,G,B,v)),!T.soul&&G>=h(i.graph[v],x)&&(e=(i.$.get(v)._.next||"")[x])&&(e.put=B,typeof(c=O(B))=="string"&&(e.put=i.$.get(c)._.put||B)),this.to&&this.to.next(y),t.any&&setTimeout.each(Object.keys(t.any),function(n){(n=t.any[n])&&n(y)},0,99),t.echo&&setTimeout.each(Object.keys(t.echo),function(n){(n=t.echo[n])&&n.on("in",y)},0,99),((y.$$||"")._||T).soul&&(e=t.next)&&(e=e[x])&&(c={},Object.keys(y).forEach(function(n){c[n]=y[n]}),c.$=(y.$$||y.$).get(c.get=x),delete c.$$,delete c.$$$,e.on("in",c)),k(y,t))}a.on.in=d;function k(y,t){if(t=t||this.as||y.$._,!(y.$$&&this!==a.on)&&!(!y.put||t.soul)){var i=y.put||"",p=i["="]||i[":"],x,T=t.root,c=T.$.get(i["#"]).get(i["."])._;if(typeof(p=O(p))!="string"){this===a.on&&((c.echo||(c.echo={}))[t.id]=t);return}if(!((c.echo||(c.echo={}))[t.id]&&!(T.pass||"")[t.id])){if(x=T.pass){if(x[p+t.id])return;x[p+t.id]=1}(c.echo||(c.echo={}))[t.id]=t,t.has&&(t.link=p);var v=T.$.get(c.link=p)._;(v.echo||(v.echo={}))[c.id]=c;var x=t.ask||"";(x[""]||t.lex)&&v.on("out",{get:{"#":p}}),setTimeout.each(Object.keys(x),function(B,G){!B||!(G=x[B])||G.on("out",{get:{"#":p,".":B}})},0,99)}}}a.on.link=k;function b(y,t){var i=y.put||"",p=u!==i["="]?i["="]:i[":"],T=t.root,c,v;if(u===p){if(t.soul&&u!==t.put||(v=(y.$$||y.$||"")._||"",y["@"]&&(u!==v.put||u!==t.put)))return;(c=t.link||y.linked)&&delete(T.$.get(c)._.echo||"")[t.id],t.has&&(t.link=null),t.put=u,setTimeout.each(Object.keys(t.next||""),function(x,B){!(B=t.next[x])||(c&&delete(T.$.get(c).get(x)._.echo||"")[B.id],B.on("in",{get:x,put:u,$:B.$}))},0,99);return}t.soul||y.$$||(c=O(p),v=y.$._||"",!((c===v.link||t.has&&!v.link)&&!((T.pass||"")[t.id]&&typeof c!="string"))&&(delete(v.echo||"")[t.id],b({get:t.get,put:u,$:y.$,linked:y.linked=y.linked||v.link},t)))}a.on.unlink=b;function s(y,t){var i=this.as,p=i.$._;p.root;var T=i.get||"",c=(y.put||"")[T["#"]]||"";if(!y.put||typeof T["."]=="string"&&u===c[T["."]]){if(u!==p.put||!p.soul&&!p.has)return;p.ack=(p.ack||0)+1,p.on("in",{get:p.get,put:p.put=u,$:p.$,"@":y["@"]});return}(y._||{}).miss=1,a.on.put(y)}var f={},u,j=String.random,O=a.valid,o=function(y,t){return y&&Object.prototype.hasOwnProperty.call(y,t)},_=a.state,h=_.is,S=_.ify})($,"./chain"),$(function(M){var a=$("./root");a.chain.get=function(u,j,O){var o,_;if(typeof u=="string"){if(u.length==0)return(o=this.chain())._.err={err:a.log("0 length key!",u)},j&&j.call(o,o._.err),o;var h=this,S=h._,y=S.next||b;(o=y[u])||(o=u&&m(u,h)),o=o&&o.$}else if(typeof u=="function"){let v=function(x,B,G){if(!v.stun&&!((g=i.pass)&&!g[p])){var e=x.$._,n=(x.$$||"")._,r=(n||e).put,l=!e.has&&!e.soul,D={},g;if((l||f===r)&&(r=f===((g=x.put)||"")["="]?f===(g||"")[":"]?g:g[":"]:g["="]),typeof(g=a.valid(r))=="string"&&(r=f===(g=i.$.get(g)._.put)?t.not?f:r:g),!(t.not&&f===r)){if(f===t.stun){if((g=i.stun)&&g.on&&(S.$.back(function(w){if(g.on(""+w.id,D={}),(D.run||0)<v.id)return D}),!D.run&&g.on(""+e.id,D={}),!D.run&&n&&g.on(""+n.id,D={}),v.id>D.run&&((!D.stun||D.stun.end)&&(D.stun=g.on("stun"),D.stun=D.stun&&D.stun.last),D.stun&&!D.stun.end))){(D.stun.add||(D.stun.add={}))[p]=function(){v(x,B,1)};return}if(f===r&&(G=0),(g=i.hatch)&&!g.end&&f===t.hatch&&!G){if(T[e.$._.id])return;T[e.$._.id]=1,g.push(function(){v(x,B,1)});return}T={}}if(i.pass){if(i.pass[p+e.id])return;i.pass[p+e.id]=1}if(t.on){t.ok.call(e.$,r,e.get,x,B||v);return}if(t.v2020){t.ok(x,B||v);return}Object.keys(x).forEach(function(w){g[w]=x[w]},g={}),x=g,x.put=r,t.ok.call(t.as,x,B||v)}}};if(j===!0)return d(this,u,j,O),this;o=this;var S=o._,t=j||{},i=S.root,p;t.at=S,t.ok=u;var T={};return v.at=S,(S.any||(S.any={}))[p=String.random(7)]=v,v.off=function(){v.stun=1,S.any&&delete S.any[p]},v.rid=k,v.id=t.run||++i.once,_=i.pass,(i.pass={})[p]=1,t.out=t.out||{get:{}},S.on("out",t.out),i.pass=_,o}else{if(typeof u=="number")return this.get(""+u,j,O);if(typeof(_=s(u))=="string")return this.get(_,j,O);(_=this.get.next)&&(o=_(this,u))}return o?(j&&typeof j=="function"&&o.get(j,O),o):((o=this.chain())._.err={err:a.log("Invalid get request!",u)},j&&j.call(o,o._.err),o)};function m(u,j){var O=j._,o=O.next,_=j.chain(),h=_._;return o||(o=O.next={}),o[h.get=u]=h,j===O.root.$?h.soul=u:(O.soul||O.has)&&(h.has=u),h}function d(u,j,O,o){var _=u._,h=0,S;return(S=_.soul||_.link)?j(S,o,_):_.jam?_.jam.push([j,o]):(_.jam=[[j,o]],u.get(function(t,i){if(!(f===t.put&&!_.root.opt.super&&(S=Object.keys(_.root.opt.peers).length)&&++h<=S)){i.rid(t);var p=(p=t.$)&&p._||{},T=0,c;for(S=_.jam,delete _.jam;c=S[T++];){var v=c[0];c=c[1],v&&v(p.link||p.soul||a.valid(t.put)||((t.put||{})._||{})["#"],c,t,i)}}},{out:{get:{".":!0}}}),u)}function k(u){var j=this.at||this.on;if(!u||j.soul||j.has)return this.off();if(!!(u=(u=(u=u.$||u)._||u).id)){j.map;var O;if((O=this.seen||(this.seen={}))[u])return!0;O[u]=!0}}var b={},s=a.valid,f})($,"./get"),$(function(M){var a=$("./root");a.chain.put=function(o,_,h){var S=this,y=S._,t=y.root;h=h||{},h.root=y.root,h.run||(h.run=t.once),m(h,y.id),h.ack=h.ack||_,h.via=h.via||S,h.data=h.data||o,h.soul||(h.soul=y.soul||typeof _=="string"&&_);var i=h.state=h.state||a.state();return typeof o=="function"?(o(function(p){h.data=p,S.put(s,s,h)}),S):h.soul?(h.$=t.$.get(h.soul),h.todo=[{it:h.data,ref:h.$}],h.turn=h.turn||u,h.ran=h.ran||d,function p(){var T=h.todo,c=T.pop(),v=c.it;c.ref&&c.ref._.id;var x,B,G,e,n;if(m(h,c.ref),(e=c.todo)&&(B=e.pop(),v=v[B],e.length&&T.push(c)),B&&(T.path||(T.path=[])).push(B),!(x=j(v))&&!(n=a.is(v))){if(!Object.plain(v)){d.err(h,"Invalid data: "+b(v)+" at "+(h.via.back(function(g){g.get&&e.push(g.get)},e=[])||e.join("."))+"."+(T.path||[]).join("."));return}for(var r=h.seen||(h.seen=[]),l=r.length;l--;)if(v===(e=r[l]).it){x=v=e.link;break}}if(B&&x)c.node=O(c.node,B,i,v);else{let g=function(w,N){var I=G.link["#"];N&&(N.off(),N.rid(w));var J=I||w.soul||(e=(w.$$||w.$)._||"").soul||e.link||((e=e.put||"")._||"")["#"]||e["#"]||((e=w.put||"")&&w.$$?e["#"]:(e["="]||e[":"]||"")["#"]);if(!I&&m(h,w.$),!J&&!c.link["#"]){(c.wait||(c.wait=[])).push(function(){g(w,N)});return}J||(J=[],(w.$$||w.$).back(function(E){if(e=E.soul||E.link)return J.push(e);J.push(E.get)}),J=J.reverse().join("/")),G.link["#"]=J,!n&&(((h.graph||(h.graph={}))[J]=G.node||(G.node={_:{}}))._["#"]=J),delete h.wait[D],G.wait&&setTimeout.each(G.wait,function(E){E&&E()}),h.ran(h)};if(!h.seen){d.err(h,"Data at root of graph must be a node (an object).");return}h.seen.push(G={it:v,link:{},todo:n?[]:Object.keys(v).sort().reverse(),path:(T.path||[]).slice(),up:c}),c.node=O(c.node,B,i,G.link),!n&&G.todo.length&&T.push(G);var D=h.seen.length;(h.wait||(h.wait={}))[D]="",e=(G.ref=n?v:B?c.ref.get(B):c.ref)._,(e=v&&(v._||"")["#"]||e.soul||e.link)?g({soul:e}):G.ref.get(g,{run:h.run,v2020:1,out:{get:{".":" "}}})}if(!T.length)return h.ran(h);h.turn(p)}(),S):(k(h),S)};function m(o,_){if(!!_){_=(_._||"").id||_;var h=o.root.stun||(o.root.stun={on:a.on}),S={},y;o.stun||(o.stun=h.on("stun",function(){})),(y=h.on(""+_))&&y.the.last.next(S),!(S.run>=o.run)&&h.on(""+_,function(t){if(o.stun.end){this.off(),this.to.next(t);return}t.run=t.run||o.run,t.stun=t.stun||o.stun})}}function d(o){if(o.err){d.end(o.stun,o.root);return}if(!(o.todo.length||o.end||!Object.empty(o.wait))){o.end=1;var _=o.$.back(-1)._,h=_.root,S=_.ask(function(p){h.on("ack",p),p.err&&!p.lack&&a.log(p),++y>(o.acks||0)&&this.off(),o.ack&&o.ack(p,this)},o.opt),y=0,t=o.stun,i;(i=function(){!t||(d.end(t,h),setTimeout.each(Object.keys(t=t.add||""),function(p){(p=t[p])&&p()}))}).hatch=i,o.ack&&!o.ok&&(o.ok=o.acks||9),o.via._.on("out",{put:o.out=o.graph,ok:o.ok&&{"@":o.ok+1},opt:o.opt,"#":S,_:i})}}d.end=function(o,_){o.end=f,o.the.to===o&&o===o.the.last&&delete _.stun,o.off()},d.err=function(o,_){(o.ack||f).call(o,o.out={err:o.err=a.log(_)}),o.ran(o)};function k(o){var _=o.via._,h;o.via=o.via.back(function(S){if(S.soul||!S.get)return S.$;h=o.data,(o.data={})[S.get]=h}),(!o.via||!o.via._.soul)&&(o.via=_.root.$.get(((o.data||"")._||"")["#"]||_.$.back("opt.uuid")())),o.via.put(o.data,o.ack,o)}function b(o,_){return o&&(_=o.constructor)&&_.name||typeof o}var s,f=function(){},u=setTimeout.turn,j=a.valid,O=a.state.ify})($,"./put"),$(function(M){var a=$("./root");$("./chain"),$("./back"),$("./put"),$("./get"),M.exports=a})($,"./index"),$(function(M){var a=$("./index");a.chain.on=function(k,b,s,f){var u=this,j=u._;j.root;var O;if(typeof k=="string")return b?(O=j.on(k,b,s||j,f),s&&s.$&&(s.subs||(s.subs=[])).push(O),u):j.on(k);var o=b;return(o=o===!0?{change:!0}:o||{}).not=1,o.on=1,u.get(k,o),u},a.chain.once=function(k,b){if(b=b||{},!k)return m(this);var s=this,f=s._,u=f.root;f.put;var j=String.random(7),O;return s.get(function(o,_,h,S){var y=this,t=y._,i=t.one||(t.one={});if(S.stun||i[j]==="")return;if((O=a.valid(o))===!0){p();return}if(typeof O=="string")return;clearTimeout((f.one||"")[j]),clearTimeout(i[j]),i[j]=setTimeout(p,b.wait||99);function p(T){if(!t.has&&!t.soul&&(t={put:o,get:_}),d===(O=t.put)&&(O=((h.$$||"")._||"").put),typeof a.valid(O)=="string"&&(O=u.$.get(O)._.put,O===d&&!T)){i[j]=setTimeout(function(){p(1)},b.wait||99);return}S.stun||i[j]!==""&&(i[j]="",(f.soul||f.has)&&S.off(),k.call(y,O,t.get),clearTimeout(i[j]))}},{on:1}),s};function m(k,b,s){return a.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),(s=k.chain())._.nix=k.once(function(f,u){s._.on("in",this._)}),s._.lex=k._.lex,s}a.chain.off=function(){var k=this,b=k._,s,f=b.back;if(!!f)return b.ack=0,(s=f.next)&&s[b.get]&&delete s[b.get],(s=f.ask)&&delete s[b.get],(s=f.put)&&delete s[b.get],(s=b.soul)&&delete f.root.graph[s],(s=b.map)&&Object.keys(s).forEach(function(u,j){j=s[u],j.link&&f.root.$.get(j.link).off()}),(s=b.next)&&Object.keys(s).forEach(function(u,j){j=s[u],j.$.off()}),b.on("off",{}),k};var d})($,"./on"),$(function(M){var a=$("./index"),m=a.chain.get.next;a.chain.get.next=function(s,f){var u;return Object.plain(f)?(u=((u=f["#"])||"")["="]||u)?s.get(u):((u=s.chain()._).lex=f,s.on("in",function(j){String.match(j.get||(j.put||"")["."],f["."]||f["#"]||f)&&u.on("in",j),this.to.next(j)}),u.$):(m||k)(s,f)},a.chain.map=function(s,f,u){var j=this,O=j._,o,_;return Object.plain(s)&&(o=s["."]?s:{".":s},s=b),s?(a.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),_=j.chain(),j.map().on(function(h,S,y,t){var i=(s||k).call(this,h,S,y,t);if(b!==i){if(h===i)return _._.on("in",y);if(a.is(i))return _._.on("in",i._);var p={};Object.keys(y.put).forEach(function(T){p[T]=y.put[T]},p),p["="]=i,_._.on("in",{get:S,put:p})}}),_):((_=O.each)||((O.each=_=j.chain())._.lex=o||_._.lex||O.lex,_._.nix=j.back("nix"),j.on("in",d,_._)),_)};function d(s){this.to.next(s);var f=this.as,u=s.$,j=u._,O=s.put,o;!j.soul&&!s.$$||(o=f.lex)&&!String.match(s.get||(O||"")["."],o["."]||o["#"]||o)||a.on.link(s,f)}var k=function(){},b})($,"./map"),$(function(M){var a=$("./index");a.chain.set=function(m,d,k){var b=this,s=b.back(-1),f,u;return d=d||function(){},k=k||{},k.item=k.item||m,(f=((m||"")._||"")["#"])&&((m={})["#"]=f),typeof(u=a.valid(m))=="string"?b.get(f=u).put(m,d,k):a.is(m)?(b.put(function(j){m.get(function(O,o,_){if(!O)return d.call(b,{err:a.log('Only a node can be linked! Not "'+_.put+'"!')});(u={})[O]={"#":O},j(u)},!0)}),m):(Object.plain(m)&&(m=s.get(f=b.back("opt.uuid")()).put(m)),b.get(f||s.back("opt.uuid")(7)).put(m,d,k))}})($,"./set"),$(function(M){$("./shim");var a=function(){},m=JSON.parseAsync||function(s,f,u){var j,O=+new Date;try{f(j,JSON.parse(s,u),d.sucks(+new Date-O))}catch(o){f(o)}},d=JSON.stringifyAsync||function(s,f,u,j){var O,o=+new Date;try{f(O,JSON.stringify(s,u,j),d.sucks(+new Date-o))}catch(_){f(_)}};d.sucks=function(s){s>99&&(console.log("Warning: JSON blocking CPU detected. Add `gun/lib/yson.js` to fix."),d.sucks=a)};function k(s){var f=function(){},u=s.opt||{};u.log=u.log||console.log,u.gap=u.gap||u.wait||0,u.max=u.max||(u.memory?u.memory*999*999:3e8)*.3,u.pack=u.pack||u.max*.01*.01,u.puff=u.puff||9;var j=setTimeout.turn||setTimeout,O=s.dup,o=O.check,_=O.track,h=f.hear=function(t,i){if(!!t){if(u.max<=t.length)return f.say({dam:"!",err:"Message too big!"},i);f===this&&(h.d+=t.length||0,++h.c);var p=i.SH=+new Date,T=t[0],c;if(T==="["){m(t,function(v,x){if(v||!x)return f.say({dam:"!",err:"DAM JSON parse error."},i);console.STAT&&console.STAT(+new Date,x.length,"# on hear batch");var B=u.puff;(function G(){for(var e=+new Date,n=0,r;n<B&&(r=x[n++]);)f.hear(r,i);x=x.slice(n),console.STAT&&console.STAT(e,+new Date-e,"hear loop"),S(i),x.length&&j(G,0)})()}),t="";return}if(T==="{"||(t["#"]||Object.plain(t))&&(c=t)){if(c)return h.one(c,i,p);m(t,function(v,x){if(v||!x)return f.say({dam:"!",err:"DAM JSON parse error."},i);h.one(x,i,p)});return}}};h.one=function(t,i,G){var T,c,v,x,B;if(t.DBG&&(t.DBG=B={DBG:t.DBG}),B&&(B.h=G),B&&(B.hp=+new Date),(T=t["#"])||(T=t["#"]=String.random(9)),!(v=o(T))&&(c=t["##"],!(c&&(v=t["@"]||t.get&&T)&&O.check(x=v+c)))){if((t._=function(){}).via=f.leap=i,(v=t["><"])&&typeof v=="string"&&v.slice(0,99).split(",").forEach(function(e){this[e]=1},t._.yo={}),v=t.dam){(v=f.hear[v])&&v(t,i,s),_(T);return}(v=t.ok)&&(t._.near=v["/"]);var G=+new Date;B&&(B.is=G),i.SI=T,s.on("in",f.last=t),B&&(B.hd=+new Date),console.STAT&&console.STAT(G,+new Date-G,t.get?"msg get":t.put?"msg put":"msg"),(v=_(T)).via=i,t.get&&(v.it=t),x&&_(x),f.leap=f.last=null}},h.c=h.d=0,function(){var t=0,i;f.hash=function(c,v){var x,B,G,e=+new Date;d(c.put,function n(r,l){var D=(B||(B=G=l||"")).slice(0,32768);if(x=String.hash(D,x),B=B.slice(32768),B){j(n,0);return}console.STAT&&console.STAT(e,+new Date-e,"say json+hash"),c._.$put=G,c["##"]=x,f.say(c,v),delete c._.$put},p)};function p(c,v){var x;return v instanceof Object?(Object.keys(v).sort().forEach(T,{to:x={},on:v}),x):v}function T(c){this.to[c]=this.on[c]}f.say=function(c,v){var x;if((x=this)&&(x=x.to)&&x.next&&x.next(c),!c)return!1;var B,G,e=c["@"],n=c._||(c._=function(){}),r=c.DBG,l=+new Date;if(n.y=n.y||l,v||r&&(r.y=l),(B=c["#"])||(B=c["#"]=String.random(9)),!i&&_(B),!c["##"]&&b!==c.put&&!n.via&&e){f.hash(c,v);return}if(!v&&e&&(v=(x=O.s[e])&&(x.via||(x=x.it)&&(x=x._)&&x.via)||(x=f.last)&&e===x["#"]&&f.leap),!v&&e)return O.s[e]?void 0:(console.STAT&&console.STAT(+new Date,++t,"total no peer to ack to"),!1);if(!v&&f.way)return f.way(c);if(r&&(r.yh=+new Date),!(G=n.raw)){f.raw(c,v);return}if(r&&(r.yr=+new Date),!v||!v.id){if(!Object.plain(v||u.peers))return!1;var l=+new Date;u.puff;var D=u.peers,g=Object.keys(v||u.peers||{});console.STAT&&console.STAT(l,+new Date-l,"peer keys"),function I(){var J=+new Date;i=1;var E=n.raw;n.raw=G;for(var P=0,C;P<9&&(C=(g||"")[P++]);)!(C=D[C]||(v||"")[C])||f.say(c,C);n.raw=E,i=0,g=g.slice(P),console.STAT&&console.STAT(J,+new Date-J,"say loop"),g.length&&(j(I,0),e&&_(e))}();return}if(!v.wire&&f.wire&&f.wire(v),B!==v.last){if(v.last=B,v===n.via||(x=n.yo)&&(x[v.url]||x[v.pid]||x[v.id]))return!1;if(console.STAT&&console.STAT(l,((r||n).yp=+new Date)-(n.y||l),"say prep"),!i&&e&&_(e),v.batch){if(v.tail=(x=v.tail||0)+G.length,v.tail<=u.pack){v.batch+=(x?",":"")+G;return}S(v)}v.batch="[";var w=+new Date;setTimeout(function(){console.STAT&&console.STAT(w,+new Date-w,"0ms TO"),S(v)},u.gap),y(G,v),console.STAT&&e===v.SI&&console.STAT(l,+new Date-v.SH,"say ack")}},f.say.c=f.say.d=0,f.raw=function(c,v){if(!c)return"";var x=c._||{},B,G;if(G=x.raw)return G;if(typeof c=="string")return c;var e=c["##"],n=c["@"];if(e&&n){if(!x.via&&o(n+e))return!1;if((G=(O.s[n]||"").it)||(G=f.last)&&n===G["#"]){if(e===G["##"])return!1;G["##"]||(G["##"]=e)}}if(!c.dam&&!c["@"]){var r=0,l=[];G=u.peers;for(var D in G){var g=G[D];if(l.push(g.url||g.pid||g.id),++r>6)break}r>1&&(c["><"]=l.join())}if(c.put&&(G=c.ok)&&(c.ok={"@":(G["@"]||1)-1,"/":G["/"]==c._.near?f.near:G["/"]}),B=x.$put){G={},Object.keys(c).forEach(function(N){G[N]=c[N]}),G.put=":])([:",d(G,function(N,I){if(!N){var J=+new Date;G=I.indexOf('"put":":])([:"'),w(b,I=I.slice(0,G+6)+B+I.slice(G+14)),console.STAT&&console.STAT(J,+new Date-J,"say slice")}});return}d(c,w);function w(N,I){N||(x.raw=I,f.say(c,v))}}}();function S(t){var i=t.batch,p=typeof i=="string";if(p&&(i+="]"),t.batch=t.tail=null,!!i&&!(p?3>i.length:!i.length)){if(!p)try{i=i.length===1?i[0]:JSON.stringify(i)}catch(T){return u.log("DAM JSON stringify error",T)}!i||y(i,t)}}function y(t,i){try{var p=i.wire;i.say?i.say(t):p.send&&p.send(t),f.say.d+=t.length||0,++f.say.c}catch{(i.queue=i.queue||[]).push(t)}}return f.near=0,f.hi=function(t){var i=t.wire,p;if(!i){f.wire(t.length&&{url:t,id:t}||t);return}t.id?u.peers[t.url||t.id]=t:(p=t.id=t.id||t.url||String.random(9),f.say({dam:"?",pid:s.opt.pid},u.peers[p]=t),delete O.s[t.last]),t.met||(f.near++,t.met=+new Date,s.on("hi",t)),p=t.queue,t.queue=[],setTimeout.each(p||[],function(T){y(T,t)},0,9)},f.bye=function(t){t.met&&--f.near,delete t.met,s.on("bye",t);var i=+new Date;i=i-(t.met||i),f.bye.time=((f.bye.time||i)+i)/2},f.hear["!"]=function(t,i){u.log("Error:",t.err)},f.hear["?"]=function(t,i){t.pid&&(i.pid||(i.pid=t.pid),t["@"])||(f.say({dam:"?",pid:u.pid,"@":t["#"]},i),delete O.s[i.last])},f.hear.mob=function(t,i){if(!!t.peers){var p=Object.keys(t.peers),T=p[Math.random()*p.length>>0];!T||(f.bye(i),f.hi(T))}},s.on("create",function(t){t.opt.pid=t.opt.pid||String.random(9),this.to.next(t),t.on("out",f.say)}),s.on("bye",function(t,i){t=u.peers[t.id||t]||t,this.to.next(t),t.bye?t.bye():(i=t.wire)&&i.close&&i.close(),delete u.peers[t.id],t.wire=null}),s.on("bye",function(t,i){this.to.next(t),(i=console.STAT)&&(i.peers=f.near),(i=t.url)&&setTimeout(function(){},u.lack||9e3)}),s.on("hi",function(t,i){if(this.to.next(t),(i=console.STAT)&&(i.peers=f.near),!u.super){var p=Object.keys(s.next||"");p.length>9999&&!console.SUBS&&console.log(console.SUBS="Warning: You have more than 10K live GETs, which might use more bandwidth than your screen can show - consider `.off()`."),setTimeout.each(p,function(T){var c=s.next[T];if(u.super||(c.ask||"")[""]){f.say({get:{"#":T}},t);return}setTimeout.each(Object.keys(c.ask||""),function(v){!v||f.say({"##":String.hash((s.graph[T]||"")[v]),get:{"#":T,".":v}},t)})})}}),f}var b;try{M.exports=k}catch{}})($,"./mesh"),$(function(M){var a=$("./index");a.Mesh=$("./mesh"),a.on("opt",function(d){if(this.to.next(d),d.once)return;var k=d.opt;if(k.WebSocket===!1)return;var b=a.window||{},s=k.WebSocket||b.WebSocket||b.webkitWebSocket||b.mozWebSocket;if(!s)return;k.WebSocket=s;var f=k.mesh=k.mesh||a.Mesh(d);f.wire||k.wire,f.wire=k.wire=u;function u(_){try{if(!_||!_.url)return S&&S(_);var h=_.url.replace(/^http/,"ws"),S=_.wire=new k.WebSocket(h);return S.onclose=function(){O(_),k.mesh.bye(_)},S.onerror=function(y){O(_)},S.onopen=function(){k.mesh.hi(_)},S.onmessage=function(y){!y||k.mesh.hear(y.data||y,_)},S}catch{k.mesh.bye(_)}}setTimeout(function(){!k.super&&d.on("out",{dam:"hi"})},1);var j=2*999;function O(_){clearTimeout(_.defer),k.peers[_.url]&&(o&&_.retry<=0||(_.retry=(_.retry||k.retry+1||60)-(-_.tried+(_.tried=+new Date)<j*4?1:0),_.defer=setTimeout(function h(){if(o&&o.hidden)return setTimeout(h,j);u(_)},j)))}var o=""+m!=typeof document&&document});var m})($,"./websocket"),$(function(M){if(!(typeof Gun>"u")){var a=function(){},m;try{m=(Gun.window||a).localStorage}catch{}m||(Gun.log("Warning: No localStorage exists to persist data to!"),m={setItem:function(k,b){this[k]=b},removeItem:function(k){delete this[k]},getItem:function(k){return this[k]}});var d=JSON.stringifyAsync||function(k,b,s,f){var u;try{b(u,JSON.stringify(k,s,f))}catch(j){b(j)}};Gun.on("create",function k(b){this.to.next(b);var s=b.opt;b.graph;var f=[],u,j,O,o;if(s.localStorage===!1)return;s.prefix=s.file||"gun/";try{u=k[s.prefix]=k[s.prefix]||JSON.parse(O=m.getItem(s.prefix))||{}}catch{u=k[s.prefix]={}}O=(O||"").length,b.on("get",function(h){this.to.next(h);var S=h.get,y,t,i,p;!S||!(y=S["#"])||(t=u[y]||p,t&&(i=S["."])&&!Object.plain(i)&&(t=Gun.state.ify({},i,Gun.state.is(t,i),t[i],y)),Gun.on.get.ack(h,t))}),b.on("put",function(h){this.to.next(h);var S=h.put,y=S["#"],t=S["."],i=h["#"],p=h.ok||"";if(u[y]=Gun.state.ify(u[y],t,S[">"],S[":"],y),o&&O>4999880){b.on("in",{"@":i,err:"localStorage max!"});return}!h["@"]&&(!h._.via||Math.random()<p["@"]/p["/"])&&f.push(i),!j&&(j=setTimeout(_,9+O/333))});function _(){if(!f.length&&((setTimeout.turn||"").s||"").length){setTimeout(_,99);return}var h=f;clearTimeout(j),j=!1,f=[],d(u,function(S,y){try{!S&&m.setItem(s.prefix,y)}catch(t){S=o=t||"localStorage failure"}S&&(Gun.log(S+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),b.on("localStorage:error",{err:S,get:s.prefix,put:u})),O=y.length,setTimeout.each(h,function(t){b.on("in",{"@":t,err:S,ok:0})},0,99)})}})}})($,"./localStorage")})(),function(){var G;if(""+G!=typeof Gun){var $=function(e){console.warn("Warning! Deprecated internal utility will break in next version:",e)},A=Gun;A.fn=A.fn||{is:function(e){return $("fn"),!!e&&typeof e=="function"}},A.bi=A.bi||{is:function(e){return $("bi"),e instanceof Boolean||typeof e=="boolean"}},A.num=A.num||{is:function(e){return $("num"),!M(e)&&(e-parseFloat(e)+1>=0||e===1/0||e===-1/0)}},A.text=A.text||{is:function(e){return $("text"),typeof e=="string"}},A.text.ify=A.text.ify||function(e){return $("text.ify"),A.text.is(e)?e:typeof JSON<"u"?JSON.stringify(e):e&&e.toString?e.toString():e},A.text.random=A.text.random||function(e,n){$("text.random");var r="";for(e=e||24,n=n||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";e>0;)r+=n.charAt(Math.floor(Math.random()*n.length)),e--;return r},A.text.match=A.text.match||function(e,n){var r,l;return $("text.match"),typeof e!="string"?!1:(typeof n=="string"&&(n={"=":n}),n=n||{},r=n["="]||n["*"]||n[">"]||n["<"],e===r?!0:l!==n["="]?!1:(r=n["*"]||n[">"]||n["<"],e.slice(0,(r||"").length)===r?!0:l!==n["*"]?!1:l!==n[">"]&&l!==n["<"]?e>=n[">"]&&e<=n["<"]:l!==n[">"]&&e>=n[">"]||l!==n["<"]&&e<=n["<"]))},A.text.hash=A.text.hash||function(e,n){if($("text.hash"),typeof e=="string"){if(n=n||0,!e.length)return n;for(var r=0,l=e.length,D;r<l;++r)D=e.charCodeAt(r),n=(n<<5)-n+D,n|=0;return n}},A.list=A.list||{is:function(e){return $("list"),e instanceof Array}},A.list.slit=A.list.slit||Array.prototype.slice,A.list.sort=A.list.sort||function(e){return $("list.sort"),function(n,r){return!n||!r?0:(n=n[e],r=r[e],n<r?-1:n>r?1:0)}},A.list.map=A.list.map||function(e,n,r){return $("list.map"),x(e,n,r)},A.list.index=1,A.obj=A.boj||{is:function(e){return $("obj"),e?e instanceof Object&&e.constructor===Object||Object.prototype.toString.call(e).match(/^\[object (\w+)\]$/)[1]==="Object":!1}},A.obj.put=A.obj.put||function(e,n,r){return $("obj.put"),(e||{})[n]=r,e},A.obj.has=A.obj.has||function(e,n){return $("obj.has"),e&&Object.prototype.hasOwnProperty.call(e,n)},A.obj.del=A.obj.del||function(e,n){if($("obj.del"),!!e)return e[n]=null,delete e[n],e},A.obj.as=A.obj.as||function(e,n,r,l){return $("obj.as"),e[n]=e[n]||(l===r?{}:r)},A.obj.ify=A.obj.ify||function(e){if($("obj.ify"),i(e))return e;try{e=JSON.parse(e)}catch{e={}}return e},function(){var e;function n(r,l){T(this,l)&&e!==this[l]||(this[l]=r)}A.obj.to=A.obj.to||function(r,l){return $("obj.to"),l=l||{},x(r,n,l),l}}(),A.obj.copy=A.obj.copy||function(e){return $("obj.copy"),e&&JSON.parse(JSON.stringify(e))},function(){function e(n,r){var l=this.n,D;if(!(l&&(r===l||i(l)&&T(l,r)))&&D!==r)return!0}A.obj.empty=A.obj.empty||function(n,r){return $("obj.empty"),n?!x(n,e,{n:r}):!0}}(),function(){function e(l,D){if(arguments.length===2){e.r=e.r||{},e.r[l]=D;return}e.r=e.r||[],e.r.push(l)}var n=Object.keys,r;Object.keys=Object.keys||function(l){return r(l,function(D,g,w){w(g)})},A.obj.map=r=A.obj.map||function(l,D,g){$("obj.map");var w,N=0,I,J,E,P,C=typeof D=="function";if(e.r=w,n&&i(l)&&(E=n(l),P=!0),g=g||{},M(l)||E)for(I=(E||l).length;N<I;N++){var q=N+A.list.index;if(C){if(J=P?D.call(g,l[E[N]],E[N],e):D.call(g,l[N],q,e),J!==w)return J}else if(D===l[P?E[N]:N])return E?E[N]:q}else for(N in l)if(C){if(T(l,N)&&(J=g?D.call(g,l[N],N,e):D(l[N],N,e),J!==w))return J}else if(D===l[N])return N;return C?e.r:A.list.index?0:-1}}(),A.time=A.time||{},A.time.is=A.time.is||function(e){return $("time"),e?e instanceof Date:+new Date().getTime()};var y=A.fn.is,M=A.list.is,t=A.obj,i=t.is,T=t.has,x=t.map,a={};a.is=function(e){return $("val.is"),e===G?!1:e===null?!0:e===1/0?!1:k(e)||d(e)||o(e)?!0:a.link.is(e)||!1},a.link=a.rel={_:"#"},function(){a.link.is=function(n){if($("val.link.is"),n&&n[m]&&!n._&&i(n)){var r={};if(x(n,e,r),r.id)return r.id}return!1};function e(n,r){var l=this;if(l.id)return l.id=!1;if(r==m&&k(n))l.id=n;else return l.id=!1}}(),a.link.ify=function(e){return $("val.link.ify"),v({},m,e)},A.obj.has._=".";var m=a.link._,G,d=A.bi.is,o=A.num.is,k=A.text.is,t=A.obj,i=t.is,v=t.put,x=t.map;A.val=A.val||a;var b={_:"_"};b.soul=function(e,n){return $("node.soul"),e&&e._&&e._[n||u]},b.soul.ify=function(e,n){return $("node.soul.ify"),n=typeof n=="string"?{soul:n}:n||{},e=e||{},e._=e._||{},e._[u]=n.soul||e._[u]||f(),e},b.soul._=a.link._,function(){b.is=function(n,r,l){$("node.is");var D;return i(n)&&(D=b.soul(n))?!x(n,e,{as:l,cb:r,s:D,n}):!1};function e(n,r){if(r!==b._){if(!a.is(n))return!0;this.cb&&this.cb.call(this.as,n,r,this.n,this.s)}}}(),function(){b.ify=function(n,r,l){return $("node.ify"),r?typeof r=="string"?r={soul:r}:typeof r=="function"&&(r={map:r}):r={},r.map&&(r.node=r.map.call(l,n,G,r.node||{})),(r.node=b.soul.ify(r.node||{},r))&&x(n,e,{o:r,as:l}),r.node};function e(n,r){var l=this.o,D,g;if(l.map){D=l.map.call(this.as,n,""+r,l.node),g===D?p(l.node,r):l.node&&(l.node[r]=D);return}a.is(n)&&(l.node[r]=n)}}();var t=A.obj,i=t.is,p=t.del,x=t.map,s=A.text,f=s.random,u=b.soul._,G;A.node=A.node||b;var j=A.state;j.lex=function(){return $("state.lex"),j().toString(36).replace(".","")},j.to=function(e,n,r){$("state.to");var l=(e||{})[n];return i(l)&&(l=B(l)),j.ify(r,n,j.is(e,n),l,b.soul(e))},function(){j.map=function(n,r,l){$("state.map");var D,g=i(g=n||r)?g:null;return n=y(n=n||r)?n:null,g&&!n?(r=o(r)?r:j(),g[h]=g[h]||{},x(g,e,{o:g,s:r}),g):(l=l||i(r)?r:D,r=o(r)?r:j(),function(w,N,I,J){if(!n)return e.call({o:I,s:r},w,N),w;n.call(l||this||{},w,N,I,J),!(T(I,N)&&D===I[N])&&e.call({o:I,s:r},w,N)})};function e(n,r){h!==r&&j.ify(this.o,r,this.s)}}();var t=A.obj;t.as;var T=t.has,i=t.is,x=t.map,B=t.copy,O=A.num,o=O.is,_=A.fn,y=_.is,h=b._,G,S={};(function(){S.is=function(r,l,D,g){return $("graph.is"),!r||!i(r)||c(r)?!1:!x(r,e,{cb:l,fn:D,as:g})};function e(r,l){if(!r||l!==b.soul(r)||!b.is(r,this.fn,this.as))return!0;!this.cb||(n.n=r,n.as=this.as,this.cb.call(n.as,r,l,n))}function n(r){r&&b.is(n.n,r,n.as)}})(),function(){S.ify=function(g,w,N){$("graph.ify");var I={path:[],obj:g};return w?typeof w=="string"?w={soul:w}:typeof w=="function"&&(w.map=w):w={},typeof N=="string"&&(w.soul=w.soul||N,N=G),w.soul&&(I.link=a.link.ify(w.soul)),w.shell=(N||{}).shell,w.graph=w.graph||{},w.seen=w.seen||[],w.as=w.as||N,e(w,I),w.root=I.node,w.graph};function e(g,w){var N;return(N=D(g,w))?N:(w.env=g,w.soul=r,b.ify(w.obj,n,w)&&(w.link=w.link||a.link.ify(b.soul(w.node)),w.obj!==g.shell&&(g.graph[a.link.is(w.link)]=w.node)),w)}function n(g,w,N){var I=this,J=I.env,E,P;if(b._===w&&T(g,a.link._))return N._;if(!!(E=l(g,w,N,I,J))){if(w||(I.node=I.node||N||{},T(g,b._)&&b.soul(g)&&(I.node._=B(g._)),I.node=b.soul.ify(I.node,a.link.is(I.link)),I.link=I.link||a.link.ify(b.soul(I.node))),(P=J.map)&&(P.call(J.as||{},g,w,N,I),T(N,w))){if(g=N[w],G===g){p(N,w);return}if(!(E=l(g,w,N,I,J)))return}if(!w)return I.node;if(E===!0)return g;if(P=e(J,{obj:g,path:I.path.concat(w)}),!!P.node)return P.link}}function r(g){var w=this,N=a.link.is(w.link),I=w.env.graph;w.link=w.link||a.link.ify(g),w.link[a.link._]=g,w.node&&w.node[b._]&&(w.node[b._][a.link._]=g),T(I,N)&&(I[g]=I[N],p(I,N))}function l(g,w,N,I,J){var E;if(a.is(g))return!0;if(i(g))return 1;if(E=J.invalid)return g=E.call(J.as||{},g,w,N),l(g,w,N,I,J);J.err="Invalid value at '"+I.path.concat(w).join(".")+"'!",A.list.is(g)&&(J.err+=" Use `.set(item)` instead of an Array.")}function D(g,w){for(var N=g.seen,I=N.length,J;I--;)if(J=N[I],w.obj===J.obj)return J;N.push(w)}}(),S.node=function(e){$("graph.node");var n=b.soul(e);if(!!n)return v({},n,e)},function(){S.to=function(n,r,l){if($("graph.to"),!!n){var D={};return l=l||{seen:{}},x(n[r],e,{obj:D,graph:n,opt:l}),D}};function e(n,r){var l,D;if(b._===r){if(c(n,a.link._))return;this.obj[r]=B(n);return}if(!(l=a.link.is(n))){this.obj[r]=n;return}if(D=this.opt.seen[l]){this.obj[r]=D;return}this.obj[r]=this.opt.seen[l]=S.to(this.graph,l,this.opt)}}();var y=A.fn.is,t=A.obj,i=t.is,p=t.del,T=t.has,c=t.empty,v=t.put,x=t.map,B=t.copy,G;A.graph=A.graph||S}}()})(X);const tt=X.exports;export{tt as G,Y as a,Z as c,L as g};
