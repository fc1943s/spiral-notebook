open solid
open state
open base_table
open row
open state_input


let chain_accounts (props : mut solid_props) =
    inl chain_accounts, set_chain_accounts = use_chain_accounts ()

    create_component base_table
        id
        fun () => ;[
            for' {
                Each' = chain_accounts ()
            } fun account => ;[
                create_custom_component row {
                    Status = CheckHidden
                    OnLoad = None
                    OnUnload = None
                    Props = fun props' => {props' with
                        Title =
                            match account.account with
                            | Admin => "admin"
                            | Player (X) => "x"
                            | Player (O) => "o"
                            | _ => ""
                            |> str |> Some
                        Children = Some fun () => ;[
                            create_component base_table
                                id
                                fun () => ;[
                                    create_custom_component row {
                                        Status = CheckHidden
                                        OnLoad = None
                                        OnUnload = None
                                        Props = fun props' => {props' with
                                            Title = Some <| str "Address"
                                            Padding = Some "3px"
                                            Children = Some fun () => ;[
                                                create_custom_component state_input {
                                                    StateGet = fun () => Some account.address
                                                    StateSet = fun value =>
                                                        set_chain_accounts <|
                                                            chain_accounts ()
                                                            |> am.map fun account' =>
                                                                if account'.account = account.account
                                                                then {account' with address = value /?? ""}
                                                                else account'
                                                }
                                            ]
                                        }
                                    }
                                    create_custom_component row {
                                        Status = CheckHidden
                                        OnLoad = None
                                        OnUnload = None
                                        Props = fun props' => {props' with
                                            Title = Some <| str "Private Key"
                                            Padding = Some "3px"
                                            Children = Some fun () => ;[
                                                create_custom_component state_input {
                                                    StateGet = fun () => Some account.private_key
                                                    StateSet = fun value =>
                                                        set_chain_accounts <|
                                                            chain_accounts ()
                                                            |> am.map fun account' =>
                                                                if account'.account = account.account
                                                                then {account' with private_key = value /?? ""}
                                                                else account'
                                                }
                                            ]
                                        }
                                    }
                                ]
                        ]
                    }
                }
            ]
        ]
