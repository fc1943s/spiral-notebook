open real_solid
open solid
open js
open real_js
open real_util
open base_checkbox
open base_select
open state
open chain
open real_state
open base_table
open row


type atom_value_props value_type =
    {
        Title : string
        Hook : () -> atom value_type
        Get : value_type -> any
    }

let atom_value forall value_type. (props : mut (atom_value_props value_type)) =
    inl (value : get value_type), (set_value : set value_type) = props.Hook ()

    create_custom_component row {
        Status = CheckHidden
        OnLoad = None
        OnUnload = None
        Props = fun props' => {props' with
            FontSize = Some "8px"
            Title = Some <| str props.Title
            Children = Some fun () => ;[
                pre
                    id
                    fun () => ;[
                        value ()
                        |> props.Get
                        |> real stringify_fmt `any
                        |> str
                    ]
            ]
        }
    }

let debug (props : mut ()) =
    inl log_level, set_log_level = use_settings_log_level ()

    box
        fun props' => {props' with
            Display = Some "flex"
            FlexDirection = Some "column"
            Overflow = Some "auto"
            Position = Some "absolute"
            Right = Some "0"
            Bottom = Some "0"
            MaxHeight = Some "80vh"
            MaxWidth = Some "50vw"
            BackgroundColor = Some "$blackAlpha9"
            ZIndex = Some 2
        }
        fun () => ;[
            create_component base_table
                id
                fun () => ;[
                    create_custom_component row {
                        Status = CheckDisabled
                        OnLoad = None
                        OnUnload = None
                        Props = fun props' => {props' with
                            Title = Some <| str "Debug"
                            Children = Some fun () => ;[
                                create_component base_table
                                    id
                                    fun () => ;[
                                        create_custom_component row {
                                            Status = CheckHidden
                                            OnLoad = None
                                            OnUnload = None
                                            Props = fun props' => {props' with
                                                Title = Some <| str "Log Level"
                                                Children = Some fun () => ;[
                                                    create_component base_simple_select
                                                        fun props' => {props' with
                                                            MarginTop = Some "2px"
                                                            Each = Some <|
                                                                a ;[Debug; Info; Warn; Error]
                                                                    |> am.map to_string
                                                                    |> am.map to_any
                                                            Value =
                                                                log_level ()
                                                                |> to_string
                                                                |> to_any
                                                                |> Some
                                                            OnChange = Some <| fun value =>
                                                                set_log_level <|
                                                                    value
                                                                    |> to_string
                                                                    |> of_string
                                                        }
                                                        fun () => ;[]
                                                ]
                                            }
                                        }
                                        create_custom_component row {
                                            Status = CheckHidden
                                            OnLoad = None
                                            OnUnload = None
                                            Props = fun props' => {props' with
                                                Title = Some <| str "State"
                                                Children = Some fun () => ;[
                                                    pre
                                                        fun props' => {props' with
                                                            FontSize = Some "8px"
                                                        }
                                                        fun () => ;[
                                                            create_custom_component atom_value {
                                                                Title = "chain.token"
                                                                Hook = use_chain_token
                                                                Get = fun value =>
                                                                    value |> to_any
                                                            }
                                                            create_custom_component atom_value {
                                                                Title = "chain.url"
                                                                Hook = use_chain_url
                                                                Get = fun value =>
                                                                    value |> to_any
                                                            }
                                                            create_custom_component atom_value {
                                                                Title = "chain.port"
                                                                Hook = use_chain_port
                                                                Get = fun value =>
                                                                    value |> to_any
                                                            }
                                                            create_custom_component atom_value {
                                                                Title = "chain.accounts"
                                                                Hook = use_chain_accounts
                                                                Get = fun value =>
                                                                    value
                                                                    |> am.map fun account' =>
                                                                        {
                                                                            account = get_atom_value account'.account
                                                                            private_key = get_atom_value account'.private_key
                                                                            address = get_atom_value account'.address
                                                                            mnemonic = get_atom_value account'.mnemonic
                                                                        }
                                                                    |> to_any
                                                            }
                                                            create_custom_component atom_value {
                                                                Title = "db.connection_status"
                                                                Hook = use_db_connection_status
                                                                Get = fun value =>
                                                                    value |> to_any
                                                            }
                                                            create_custom_component atom_value {
                                                                Title = "db.connection"
                                                                Hook = use_db_connection
                                                                Get = fun value =>
                                                                    value |> to_any
                                                            }
                                                            create_custom_component atom_value {
                                                                Title = "settings.log_level"
                                                                Hook = use_settings_log_level
                                                                Get = fun value =>
                                                                    value |> to_string |> to_any
                                                            }
                                                            create_custom_component atom_value {
                                                                Title = "settings.ui.modal"
                                                                Hook = use_settings_ui_modal
                                                                Get = fun value =>
                                                                    value |> to_any
                                                            }
                                                            create_custom_component atom_value {
                                                                Title = "profile.tmp.counter"
                                                                Hook = use_profile_tmp_counter
                                                                Get = fun value =>
                                                                    value |> to_any
                                                            }
                                                            create_custom_component atom_value {
                                                                Title = "profile.tmp.chain_status"
                                                                Hook = use_profile_tmp_chain_status
                                                                Get = fun value =>
                                                                    value |> to_any
                                                            }
                                                            create_custom_component atom_value {
                                                                Title = "profile.tmp.chain_deploy"
                                                                Hook = use_profile_tmp_chain_deploy
                                                                Get = fun value =>
                                                                    value |> to_any
                                                            }
                                                        ]
                                                ]
                                            }
                                        }
                                    ]
                            ]
                        }
                    }
                ]
        ]
