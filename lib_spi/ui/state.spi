open js
open real_js
open solid
open db


// import './buffer-shim'
// import * as db from "./db"
// import * as chain from "./chain"
// import * as profile from "./profile"
// import * as util from "../../lib_ts/util"
// import * as tictactoe_testnet from "../../lib_ts/tictactoe_testnet"
// import * as components_spi from "../../lib_ts/components_spi"
// import { StoreonStore } from 'storeon'


// export type State = db.DbState & chain.ChainState & profile.ProfileState

// const init: State = {
//     chainToken: tictactoe_testnet.token,
//     chainUrl: util.CODESPACE_NAME ? `http://${util.CODESPACE_NAME}-4001.githubpreview.dev` : tictactoe_testnet.url,
//     chainPort: util.CODESPACE_NAME ? 80 : tictactoe_testnet.port,
//     chainAccounts: tictactoe_testnet.accounts,
//     dbConnection: {
//         gun_rs: {
//             url: util.CODESPACE_NAME && !util.IS_TEST ? `ws://${util.CODESPACE_NAME}-4944.githubpreview.dev` : 'ws://localhost',
//             port: util.CODESPACE_NAME && !util.IS_TEST ? 80 : (util.IS_TEST ? 14944 : 4944),
//             ws: "ws"
//         },
//         gun_js: {
//             url: util.CODESPACE_NAME && !util.IS_TEST ? `ws://${util.CODESPACE_NAME}-8765.githubpreview.dev` : 'wss://localhost',
//             port: util.CODESPACE_NAME && !util.IS_TEST ? 80 : (util.IS_TEST ? 18765 : 8765),
//             ws: "gun"
//         }
//     },
//     dbStatus: {
//         gun_rs: {
//             gun_rs: false,
//             gun_js: false
//         } as { [_ in db.DbType]: boolean },
//         gun_js: {
//             gun_rs: false,
//             gun_js: false
//         } as { [_ in db.DbType]: boolean }
//     },
//     dbRef: {},
//     profile: {
//         tmp: {}
//     }
// }

type account__ = {alias : string; address : string; private_key : string; mnemonic : string}
type db_connection = {db_type : db_type; url : string; port : i32; ws : string}
type db_status = {client : db_type; server : db_type}
type state__ =
    {
        chain : {
            token : option string
            url : option string
            port : option i32
            accounts : a i32 account__
        }
        db : {
            connection : a i32 db_connection
            status : a i32 db_status
        }
        ui : {
            modal : option i32
        }
        profile : {
            tmp : {
                counter : a i32 (i32 * i32)
                chain_status : a i32 (i32 * any)
                chain_deploy : a i32 (i32 * any)
            }
        }
    }

inl empty_state () : state__ =
    join
        {
            chain = {
                token = Some (tictactoe_testnet.token ())
                url = Some (tictactoe_testnet.url ())
                port = Some (tictactoe_testnet.port ())
                accounts = tictactoe_testnet.accounts ()
            }
            db = {
                status = a ;[]
                connection = a ;[]
            }
            ui = {
                modal = None
            }
            profile = {
                tmp = {
                    counter = a ;[]
                    chain_status = a ;[]
                    chain_deploy = a ;[]
                }
            }
        }

inl empty_db_connection () : db_connection =
    join
        {
            db_type = GunRs
            url = ""
            port = 0
            ws = ""
        }
